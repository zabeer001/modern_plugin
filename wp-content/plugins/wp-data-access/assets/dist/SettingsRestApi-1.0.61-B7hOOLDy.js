import{j as s}from"./cm-1.0.61-D9ug3d5m.js";import{r as y}from"./redux-1.0.61-CrJ4jvTM.js";import{y as I,z as H}from"./index-1.0.61-B7tjLD84.js";import{a as W}from"./hooks-1.0.61-Bklk-gZu.js";import{l as g,R as b,r as Y,bO as Z,bP as B,bQ as _}from"./lib-1.0.61-DoXQcMHD.js";import{u as q}from"./ExplorerActionAdmin-1.0.61-A2MYAPhT.js";import{u as Q}from"./useExplorer-1.0.61-BwAinfQj.js";/* empty css                    */import{A as U,a as M}from"./AccordionSummary-1.0.61-B21Kp3oq.js";import{A as F}from"./AccordionDetails-1.0.61-CrQNuW_u.js";import{B as S}from"./Spinner-1.0.61-khi9zO7Q.js";import{a as A,F as J,T as k,b as C}from"./TextField-1.0.61-DyvT2G_W.js";import{F as v}from"./FormControlLabel-1.0.61-Bu2IQ4da.js";import{S as w}from"./Switch-1.0.61-CRYcdQMV.js";import{R as K}from"./RadioGroup-1.0.61-BZHJMWN9.js";import{R as L}from"./Radio-1.0.61-BXMcBwcB.js";import{A as N}from"./Autocomplete-1.0.61-CP0PiliY.js";import{C as G}from"./Chip-1.0.61-C6TjQKDp.js";import"./vendor-1.0.61-CN03Eozo.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./notistack-1.0.61-0awN6uG4.js";import"./iconBase-1.0.61-C8saXaJ2.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./cmJson-1.0.61-BLURwXOE.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./settings-1.0.61-BN5quc55.js";import"./Link-1.0.61-BHBICLVE.js";import"./TabPanel-1.0.61-BtYzUOMH.js";import"./InputAdornment-1.0.61-23wkGu1k.js";import"./cjs-1.0.61-D_0erLfe.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./Select-1.0.61-DmroHcG5.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./ConfirmDialog-1.0.61-BrxkBu_y.js";import"./AdminTheme-1.0.61-D8bUxwpM.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./CardHeader-1.0.61-gDG-f_-J.js";import"./MenuItem-1.0.61-Bmr1xWyp.js";import"./Tooltip-1.0.61-De3BL3Jg.js";import"./ActionsExplorer-1.0.61-Bj7vTxIj.js";import"./RestApi-1.0.61-DdTZ_pIc.js";import"./index-1.0.61-Cpig8940.js";import"./ActionsDml-1.0.61-DA32DqSB.js";import"./ExplorerActionEnum-1.0.61-eclZgKpy.js";import"./useUiExplorerAction-1.0.61-hK1pO-t3.js";import"./Collapse-1.0.61-Cww0NnSm.js";import"./SwitchBase-1.0.61-C2xa6JFZ.js";import"./Close-1.0.61-CiuKDfYz.js";var p=(r=>(r.SELECT="select",r.INSERT="insert",r.UPDATE="update",r.DELETE="delete",r))(p||{}),R=(r=>(r.GET="GET",r.POST="POST",r))(R||{});const O=({restApi:r,action:l,roles:T,users:i,setRestApi:d,expanded:c,setExpanded:n})=>{g.debug(r,l,T,i,c);const z=(e,o)=>{const a=Y(r);if(o)a.methods.push(e);else{const m=a.methods.indexOf(e);m>-1&&a.methods.splice(m,1)}g.debug(e,o,a),d(a)},P=e=>{g.debug(e),d({...r,authorization:e})},j=e=>{g.debug(e),d({...r,authorized_roles:e.map(o=>o.key)})},E=e=>{g.debug(e),d({...r,authorized_users:e.map(o=>o.key)})},x=y.useMemo(()=>T.filter(e=>r.authorized_roles.includes(e.key)),[r.authorized_roles,T]),h=y.useMemo(()=>i.filter(e=>r.authorized_users.includes(e.key)),[r.authorized_users,i]);return s.jsxs(U,{disableGutters:!0,expanded:c===l.toString(),onChange:()=>{c===l.toString()?n(""):n(l)},children:[s.jsx(M,{expandIcon:s.jsx(I,{}),sx:{textTransform:"capitalize"},children:l}),s.jsx(F,{children:s.jsxs(S,{sx:{display:"grid",gridGap:"20px"},children:[s.jsx(A,{children:"Supported HTTP methods"}),s.jsxs(S,{children:[s.jsx(v,{control:s.jsx(w,{checked:r.methods.includes(R.GET),onChange:(e,o)=>{z(R.GET,o),e.stopPropagation()}}),label:"GET",labelPlacement:"end"}),s.jsx(v,{control:s.jsx(w,{checked:r.methods.includes(R.POST),onChange:(e,o)=>{z(R.POST,o),e.stopPropagation()}}),label:"POST",labelPlacement:"end"})]}),s.jsx(A,{children:"Authorization"}),s.jsxs(J,{sx:{marginLeft:"-10px"},children:[s.jsxs(K,{children:[s.jsxs(A,{className:"align-label-radio",sx:{cursor:"pointer"},children:[s.jsx(L,{checked:r.authorization===b.AUTHORIZED,onChange:e=>{P(b.AUTHORIZED),e.stopPropagation()}}),"Authorized access only"]}),s.jsxs(S,{sx:{display:"grid",gridGap:"10px",margin:"20px 10px 20px 42px"},children:[s.jsx(N,{multiple:!0,disableCloseOnSelect:!0,options:T,getOptionLabel:e=>e.value,value:x,onChange:(e,o)=>{j(o)},renderInput:e=>s.jsx(k,{...e,label:"Roles"}),renderTags:(e,o)=>e.map((a,m)=>{const{key:f,...t}=o({index:m});return s.jsx(G,{variant:"outlined",label:a.value,...t},f)})}),s.jsx(N,{multiple:!0,disableCloseOnSelect:!0,options:i,getOptionLabel:e=>e.value,value:h,onChange:(e,o)=>{E(o)},renderInput:e=>s.jsx(k,{...e,label:"Users"}),renderTags:(e,o)=>e.map((a,m)=>{const{key:f,...t}=o({index:m});return s.jsx(G,{variant:"outlined",label:a.value,...t},f)})})]}),s.jsxs(A,{className:"align-label-radio",sx:{cursor:"pointer"},children:[s.jsx(L,{checked:r.authorization===b.ANONYMOUS,onChange:e=>{P(b.ANONYMOUS),e.stopPropagation()}}),"Anonymous access"]})]}),r.authorization===b.ANONYMOUS&&r.methods.length>0&&s.jsxs(S,{sx:{marginTop:"10px",marginLeft:"10px"},children:[(l===p.INSERT||l===p.UPDATE||l===p.DELETE)&&s.jsx(C,{children:"This setting allows non-authorized users to modify this table"}),l===p.SELECT&&s.jsx(C,{children:"This setting allows non-authorized users to query this table"})]})]})]})})]})},$e=({dbs:r,tbl:l,typ:T,metaData:i,setIsUpdated:d})=>{var o,a,m,f;g.debug(r,l,T,i);const c=W(),n=q(),P=Q().selected,[j,E]=y.useState(""),x=[];if(((a=(o=i==null?void 0:i.settings)==null?void 0:o.wp)==null?void 0:a.roles)!==void 0)for(const t in i.settings.wp.roles)x.push({key:t,value:i.settings.wp.roles[t]});g.debug(x);const h=[];if(((f=(m=i==null?void 0:i.settings)==null?void 0:m.wp)==null?void 0:f.users)!==void 0)for(const t in i.settings.wp.users)h.push({key:t,value:i.settings.wp.users[t]});g.debug(h);const e={authorization:b.AUTHORIZED,methods:[],authorized_roles:[],authorized_users:[]};return s.jsxs(U,{disableGutters:!0,slotProps:{transition:{unmountOnExit:!0}},children:[s.jsx(M,{expandIcon:s.jsx(I,{}),children:"REST API"}),s.jsx(F,{children:s.jsxs(S,{children:[s.jsx(v,{control:s.jsx(w,{checked:n.rest_api!==null,onClick:t=>{n.rest_api!==null?c(Z()):c(B()),d(!0),t.stopPropagation()}}),label:"Enable REST API",labelPlacement:"end"}),n.rest_api!==null&&s.jsxs(S,{sx:{marginTop:"20px"},children:[s.jsx(O,{restApi:n.rest_api.select??e,action:p.SELECT,roles:x,users:h,setRestApi:t=>{const u={...n.rest_api};u[p.SELECT]=t,c(_({rest_api:u})),d(!0)},expanded:j,setExpanded:E}),s.jsx(O,{restApi:n.rest_api.insert??e,action:p.INSERT,roles:x,users:h,setRestApi:t=>{const u={...n.rest_api};u[p.INSERT]=t,c(_({rest_api:u})),d(!0)},expanded:j,setExpanded:E}),s.jsx(O,{restApi:n.rest_api.update??e,action:p.UPDATE,roles:x,users:h,setRestApi:t=>{const u={...n.rest_api};u[p.UPDATE]=t,c(_({rest_api:u})),d(!0)},expanded:j,setExpanded:E}),s.jsx(O,{restApi:n.rest_api.delete??e,action:p.DELETE,roles:x,users:h,setRestApi:t=>{const u={...n.rest_api};u[p.DELETE]=t,c(_({rest_api:u})),d(!0)},expanded:j,setExpanded:E})]}),P[r]==="system"||P[r]==="wp"&&i.settings.wp.tables.includes(l)&&s.jsxs(C,{sx:{display:"inline-grid",gridTemplateColumns:"20px auto",gridGap:"5px",marginTop:"20px",alignItems:"center","& svg":{fontSize:"20px"}},children:[s.jsx(H,{}),"We discourage enabling REST API services for WordPress and system tables"]})]})})]})};export{$e as default};
