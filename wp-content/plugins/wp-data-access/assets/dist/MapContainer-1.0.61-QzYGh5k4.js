const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Alert-1.0.61-BDxavmCg.js","./cm-1.0.61-D9ug3d5m.js","./redux-1.0.61-CrJ4jvTM.js","./vendor-1.0.61-CN03Eozo.js","./index-1.0.61-Cpig8940.js","./iconBase-1.0.61-C8saXaJ2.js","./Typography-1.0.61-Cg0Css-P.js","./lib-1.0.61-DoXQcMHD.js","./loglevel-1.0.61-BZ7XahX3.js","./lodash-1.0.61-C8OpKhUs.js","./moment-1.0.61-C5S46NFB.js","./ButtonBase-1.0.61-BqsrQx8o.js","./useEnhancedEffect-1.0.61-CX4-xj9Z.js","./AlertTitle-1.0.61-hpo1u3Vv.js","./createSvgIcon-1.0.61-DDgmYdEo.js","./Close-1.0.61-CiuKDfYz.js","./Settings-1.0.61-Kp0HHSeJ.js","./cmJson-1.0.61-BLURwXOE.js","./rehyperaw-1.0.61-AkovKNCK.js","./markdown-1.0.61-6nAzZWly.js","./hooks-1.0.61-Bklk-gZu.js","./settings-1.0.61-BN5quc55.js","./index-1.0.61-B7tjLD84.js","./ThemeProvider-1.0.61-4HOD8y6D.js","./Modal-1.0.61-DVFPMIPt.js","./notistack-1.0.61-0awN6uG4.js","./Link-1.0.61-BHBICLVE.js","./TabPanel-1.0.61-BtYzUOMH.js","./InputAdornment-1.0.61-23wkGu1k.js","./cjs-1.0.61-D_0erLfe.js","./getThemeProps-1.0.61-OfsHdeDz.js","./Select-1.0.61-DmroHcG5.js","./Menu-1.0.61-D2OtRuzX.js","./ConfirmDialog-1.0.61-BrxkBu_y.js","./AdminTheme-1.0.61-D8bUxwpM.js","./DialogContent-1.0.61-Ws3r0VFj.js","./Spinner-1.0.61-khi9zO7Q.js","./CardHeader-1.0.61-gDG-f_-J.js","./TextField-1.0.61-DyvT2G_W.js","./MenuItem-1.0.61-Bmr1xWyp.js","./settings-1.0.61-DuwCupdk.css","./Tooltip-1.0.61-De3BL3Jg.js","./Tooltip-1.0.61--D4jr2go.css","./ActionsSettings-1.0.61-NFzvwy8a.js","./RestApi-1.0.61-DdTZ_pIc.js","./TargetEnum-1.0.61-CIW1jlU5.js","./useMapUpdater-1.0.61-BifPauYu.js","./DynamicModeEnum-1.0.61-BXuL5kgA.js"])))=>i.map(i=>d[i]);
import{i as Te,_ as pe}from"./cmJson-1.0.61-BLURwXOE.js";import{j as m}from"./cm-1.0.61-D9ug3d5m.js";import{r as a,R as k}from"./redux-1.0.61-CrJ4jvTM.js";import{r as he,e as $}from"./notistack-1.0.61-0awN6uG4.js";import{a5 as je,l as F,ac as Re,f as ze,ad as Fe,_ as Be,a9 as De,t as Ue,Z as Ge,C as He,a8 as Ze,ae as z,af as $e,ag as Je}from"./lib-1.0.61-DoXQcMHD.js";import{u as Ke,a as ve}from"./hooks-1.0.61-Bklk-gZu.js";import{a as Ve}from"./AdminTheme-1.0.61-D8bUxwpM.js";import{a as We}from"./RestApi-1.0.61-DdTZ_pIc.js";import"./dompurify-1.0.61-DhD2mIk-.js";import"./moment-1.0.61-C5S46NFB.js";import{u as qe}from"./useMetadata-1.0.61-CVl9oDgw.js";import{u as Ye,a as Xe}from"./useRemoveAppFromStore-1.0.61-E72jey9_.js";import{A as Qe,T as ye,e as le,g as et,M as tt}from"./index-1.0.61-B7tjLD84.js";import{T as nt}from"./Typography-1.0.61-Cg0Css-P.js";import{B as be,S as rt}from"./Spinner-1.0.61-khi9zO7Q.js";import{I as ce}from"./iconBase-1.0.61-C8saXaJ2.js";import{F as ot}from"./FallbackSpinner-1.0.61-s3WTN65t.js";import{A as it,u as at}from"./AppTheme-1.0.61-CGnMRNDC.js";import{a as st}from"./index-1.0.61-BRtOqdFl.js";import{S as lt}from"./Select-1.0.61-DmroHcG5.js";import{M as ct}from"./MenuItem-1.0.61-Bmr1xWyp.js";import{T as ut,a as ue}from"./ToggleButtonGroup-1.0.61-31GAUuTm.js";import{g as dt}from"./tab-1.0.61-B4c65fpQ.js";import{T as de}from"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./vendor-1.0.61-CN03Eozo.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./Languages-1.0.61-BxgPwugF.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./index-1.0.61-CRnugLvI.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";function N(){return N=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},N.apply(null,arguments)}function B(t,e){if(t==null)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.indexOf(i)!==-1)continue;n[i]=t[i]}return n}function mt(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function ft(t){var e=mt(t,"string");return typeof e=="symbol"?e:e+""}const R={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"},gt="https://maps.googleapis.com/maps/api/js";class G{static async load(e,n){var i;const s=e.libraries?e.libraries.split(","):[],r=this.serializeParams(e);this.listeners.push(n),(i=window.google)!=null&&(i=i.maps)!=null&&i.importLibrary?(this.serializedApiParams||(this.loadingStatus=R.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=r,this.initImportLibrary(e)),this.serializedApiParams&&this.serializedApiParams!==r&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");const o=["maps",...s];await Promise.all(o.map(l=>google.maps.importLibrary(l)))}static serializeParams(e){return[e.v,e.key,e.language,e.region,e.authReferrerPolicy,e.solutionChannel].join("/")}static initImportLibrary(e){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let n=null;const i=()=>n||(n=new Promise((s,r)=>{var o;const l=document.createElement("script"),c=new URLSearchParams;for(const[f,g]of Object.entries(e)){const y=f.replace(/[A-Z]/g,v=>"_"+v[0].toLowerCase());c.set(y,String(g))}c.set("loading","async"),c.set("callback","__googleMapsCallback__"),l.async=!0,l.src=gt+"?"+c.toString(),l.nonce=((o=document.querySelector("script[nonce]"))==null?void 0:o.nonce)||"",l.onerror=()=>{this.loadingStatus=R.FAILED,this.notifyLoadingStatusListeners(),r(new Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=R.LOADED,this.notifyLoadingStatusListeners(),s()},window.gm_authFailure=()=>{this.loadingStatus=R.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=R.LOADING,this.notifyLoadingStatusListeners(),document.head.append(l)}),n);google.maps.importLibrary=s=>i().then(()=>google.maps.importLibrary(s))}static notifyLoadingStatusListeners(){for(const e of this.listeners)e(this.loadingStatus)}}G.loadingStatus=R.NOT_LOADED;G.serializedApiParams=void 0;G.listeners=[];const pt=["onLoad","onError","apiKey","version","libraries"],ht=["children"],vt="GMP_visgl_rgmlibrary_v1_default",H=k.createContext(null);function yt(){const[t,e]=a.useState({});return{mapInstances:t,addMapInstance:(r,o="default")=>{e(l=>N({},l,{[o]:r}))},removeMapInstance:(r="default")=>{e(o=>B(o,[r].map(ft)))},clearMapInstances:()=>{e({})}}}function bt(t){const{onLoad:e,onError:n,apiKey:i,version:s,libraries:r=[]}=t,o=B(t,pt),[l,c]=a.useState(G.loadingStatus),[f,g]=a.useReducer((d,b)=>d[b.name]?d:N({},d,{[b.name]:b.value}),{}),y=a.useMemo(()=>r==null?void 0:r.join(","),[r]),v=a.useMemo(()=>JSON.stringify(N({apiKey:i,version:s},o)),[i,s,o]),h=a.useCallback(async d=>{var b;if(f[d])return f[d];if(!((b=google)!=null&&(b=b.maps)!=null&&b.importLibrary))throw new Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");const M=await window.google.maps.importLibrary(d);return g({name:d,value:M}),M},[f]);return a.useEffect(()=>{(async()=>{try{const d=N({key:i},o);s&&(d.v=s),(y==null?void 0:y.length)>0&&(d.libraries=y),(d.channel===void 0||d.channel<0||d.channel>999)&&delete d.channel,d.solutionChannel===void 0?d.solutionChannel=vt:d.solutionChannel===""&&delete d.solutionChannel,await G.load(d,b=>c(b));for(const b of["core","maps",...r])await h(b);e&&e()}catch(d){n?n(d):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",d)}})()},[i,y,v]),{status:l,loadedLibraries:f,importLibrary:h}}const Ct=t=>{const{children:e}=t,n=B(t,ht),{mapInstances:i,addMapInstance:s,removeMapInstance:r,clearMapInstances:o}=yt(),{status:l,loadedLibraries:c,importLibrary:f}=bt(n),g=a.useMemo(()=>({mapInstances:i,addMapInstance:s,removeMapInstance:r,clearMapInstances:o,status:l,loadedLibraries:c,importLibrary:f}),[i,s,r,o,l,c,f]);return k.createElement(H.Provider,{value:g},e)};function Mt(t,e){for(const n of Et){const i=e[n],s=Ce[n];a.useEffect(()=>{if(!t||!i)return;const r=google.maps.event.addListener(t,s,o=>{i(Lt(s,t,o))});return()=>r.remove()},[t,s,i])}}function Lt(t,e,n){const i={type:t,map:e,detail:{},stoppable:!1,stop:()=>{}};if(kt.includes(t)){const r=i,o=e.getCenter(),l=e.getZoom(),c=e.getHeading()||0,f=e.getTilt()||0,g=e.getBounds();return(!o||!g||!Number.isFinite(l))&&console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),r.detail={center:(o==null?void 0:o.toJSON())||{lat:0,lng:0},zoom:l||0,heading:c,tilt:f,bounds:(g==null?void 0:g.toJSON())||{north:90,east:180,south:-90,west:-180}},r}else if(xt.includes(t)){var s;if(!n)throw new Error("[createEvent] mouse events must provide a srcEvent");const r=i;return r.domEvent=n.domEvent,r.stoppable=!0,r.stop=()=>n.stop(),r.detail={latLng:((s=n.latLng)==null?void 0:s.toJSON())||null,placeId:n.placeId},r}return i}const Ce={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},kt=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],xt=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],Et=Object.keys(Ce);function It(t,e){const n=a.useRef(void 0);(!n.current||!Te(e,n.current))&&(n.current=e),a.useEffect(t,n.current)}const _t=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function At(t,e){const n={},i=Object.keys(e);for(const s of i)_t.has(s)&&(n[s]=e[s]);It(()=>{t&&t.setOptions(n)},[n])}function Me(){var t;return((t=a.useContext(H))==null?void 0:t.status)||R.NOT_LOADED}function Ot(t,e){const{viewport:n,viewState:i}=e,s=!!n;return a.useLayoutEffect(()=>{if(!t||!i)return;const{latitude:r,longitude:o,bearing:l,pitch:c,zoom:f}=i;t.moveCamera({center:{lat:r,lng:o},heading:l,tilt:c,zoom:f+1})},[t,i]),s}function St(t){return!t||typeof t!="object"||!("lat"in t&&"lng"in t)?!1:Number.isFinite(t.lat)&&Number.isFinite(t.lng)}function Le(t){return St(t)?t:t.toJSON()}function Nt(t,e,n){const i=n.center?Le(n.center):null;let s=null,r=null;i&&Number.isFinite(i.lat)&&Number.isFinite(i.lng)&&(s=i.lat,r=i.lng);const o=Number.isFinite(n.zoom)?n.zoom:null,l=Number.isFinite(n.heading)?n.heading:null,c=Number.isFinite(n.tilt)?n.tilt:null;a.useLayoutEffect(()=>{if(!t)return;const f={};let g=!1;s!==null&&r!==null&&(e.current.center.lat!==s||e.current.center.lng!==r)&&(f.center={lat:s,lng:r},g=!0),o!==null&&e.current.zoom!==o&&(f.zoom=o,g=!0),l!==null&&e.current.heading!==l&&(f.heading=l,g=!0),c!==null&&e.current.tilt!==c&&(f.tilt=c,g=!0),g&&t.moveCamera(f)})}const Pt=()=>{const t={position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"};return k.createElement("div",{style:t},k.createElement("h2",null,"Error: AuthFailure"),k.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",k.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."))};function wt(){const[t,e]=a.useState(null),n=a.useCallback(i=>e(i),[e]);return[t,n]}function ke(){return Me()===R.LOADED}function Tt(){const[,t]=a.useReducer(e=>e+1,0);return t}function jt(t,e){const n=t.getCenter(),i=t.getZoom(),s=t.getHeading()||0,r=t.getTilt()||0,o=t.getBounds();(!n||!o||!Number.isFinite(i))&&console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(e.current,{center:(n==null?void 0:n.toJSON())||{lat:0,lng:0},zoom:i||0,heading:s,tilt:r})}function Rt(t){const e=Tt(),n=a.useRef({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return a.useEffect(()=>{if(!t)return;const i=google.maps.event.addListener(t,"bounds_changed",()=>{jt(t,n),e()});return()=>i.remove()},[t,e]),n}const zt=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],Ft=["padding"];class V{static has(e){return this.entries[e]&&this.entries[e].length>0}static pop(e){return this.entries[e]&&this.entries[e].pop()||null}static push(e,n){this.entries[e]||(this.entries[e]=[]),this.entries[e].push(n)}}V.entries={};function Bt(t,e){const n=ke(),[i,s]=a.useState(null),[r,o]=wt(),l=Rt(i),{id:c,defaultBounds:f,defaultCenter:g,defaultZoom:y,defaultHeading:v,defaultTilt:h,reuseMaps:d,renderingType:b,colorScheme:M}=t,C=B(t,zt),L=t.zoom!==void 0||t.defaultZoom!==void 0,P=t.center!==void 0||t.defaultCenter!==void 0;!f&&(!L||!P)&&console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!C.center&&g&&(C.center=g),!C.zoom&&Number.isFinite(y)&&(C.zoom=y),!C.heading&&Number.isFinite(v)&&(C.heading=v),!C.tilt&&Number.isFinite(h)&&(C.tilt=h);for(const _ of Object.keys(C))C[_]===void 0&&delete C[_];const A=a.useRef(void 0);return a.useEffect(()=>{if(!r||!n)return;const{addMapInstance:_,removeMapInstance:x}=e,{mapId:S}=t,T=`${S||"default"}:${b||"default"}:${M||"LIGHT"}`;let w,I;if(d&&V.has(T)?(I=V.pop(T),w=I.getDiv(),r.appendChild(w),I.setOptions(C),setTimeout(()=>I.setCenter(I.getCenter()),0)):(w=document.createElement("div"),w.style.height="100%",r.appendChild(w),I=new google.maps.Map(w,N({},C,b?{renderingType:b}:{},M?{colorScheme:M}:{}))),s(I),_(I,c),f){const{padding:D}=f,U=B(f,Ft);I.fitBounds(U,D)}else(!L||!P)&&I.fitBounds({east:180,west:-180,south:-90,north:90});if(A.current){const{mapId:D,cameraState:U}=A.current;D!==S&&I.setOptions(U)}return()=>{A.current={mapId:S,cameraState:l.current},w.remove(),d?V.push(T,I):google.maps.event.clearInstanceListeners(I),s(null),x(c)}},[r,n,c,t.mapId,t.renderingType,t.colorScheme]),[i,o,l]}const xe=k.createContext(null),Ee=t=>{const{children:e,id:n,className:i,style:s}=t,r=a.useContext(H),o=Me();if(!r)throw new Error("<Map> can only be used inside an <ApiProvider> component.");const[l,c,f]=Bt(t,r);Nt(l,f,t),Mt(l,t),At(l,t);const g=Ot(l,t),y=!!t.controlled;a.useEffect(()=>{if(l)return g&&l.setOptions({disableDefaultUI:!0}),(g||y)&&l.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{l.setOptions({gestureHandling:t.gestureHandling,keyboardShortcuts:t.keyboardShortcuts})}},[l,g,y,t.gestureHandling,t.keyboardShortcuts]);const v=t.center?Le(t.center):null;let h=null,d=null;v&&Number.isFinite(v.lat)&&Number.isFinite(v.lng)&&(h=v.lat,d=v.lng);const b=a.useMemo(()=>{var L,P,A,_,x;return{center:{lat:(L=h)!=null?L:0,lng:(P=d)!=null?P:0},zoom:(A=t.zoom)!=null?A:0,heading:(_=t.heading)!=null?_:0,tilt:(x=t.tilt)!=null?x:0}},[h,d,t.zoom,t.heading,t.tilt]);a.useLayoutEffect(()=>{if(!l||!y)return;l.moveCamera(b);const L=l.addListener("bounds_changed",()=>{l.moveCamera(b)});return()=>L.remove()},[l,y,b]);const M=a.useMemo(()=>N({width:"100%",height:"100%",position:"relative",zIndex:g?-1:0},s),[s,g]),C=a.useMemo(()=>({map:l}),[l]);return o===R.AUTH_FAILURE?k.createElement("div",{style:N({position:"relative"},i?{}:M),className:i},k.createElement(Pt,null)):k.createElement("div",N({ref:c,"data-testid":"map",style:i?void 0:M,className:i},n?{id:n}:{}),l?k.createElement(xe.Provider,{value:C},e):null)};Ee.deckGLViewProps=!0;const me=new Set;function W(...t){const e=JSON.stringify(t);me.has(e)||(me.add(e),console.error(...t))}const Ie=(t=null)=>{const e=a.useContext(H),{map:n}=a.useContext(xe)||{};if(e===null)return W("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;const{mapInstances:i}=e;return t!==null?i[t]||null:n||i.default||null};function Dt(t){const e=ke(),n=a.useContext(H);return a.useEffect(()=>{!e||!n||n.importLibrary(t)},[e,n,t]),(n==null?void 0:n.loadedLibraries[t])||null}function J(t,e,n){a.useEffect(()=>{if(!t||!e||!n)return;const i=google.maps.event.addListener(t,e,n);return()=>i.remove()},[t,e,n])}function K(t,e,n){a.useEffect(()=>{t&&(t[e]=n)},[t,e,n])}function fe(t,e,n){a.useEffect(()=>{if(!(!t||!e||!n))return t.addEventListener(e,n),()=>t.removeEventListener(e,n)},[t,e,n])}function Ut(t){return t.nodeType===Node.ELEMENT_NODE}const _e=k.createContext(null),Gt={BOTTOM:["50%","100%"]},Ht=({children:t,styles:e,className:n,anchorPoint:i})=>{const[s,r]=i??Gt.BOTTOM;let o=`-${s}`,l=`-${r}`;s.trimStart().startsWith("-")&&(o=s.substring(1)),r.trimStart().startsWith("-")&&(l=r.substring(1));const c=`translate(50%, 100%) translate(${o}, ${l})`;return k.createElement("div",{style:{transform:c}},k.createElement("div",{className:n,style:e},t))};function Zt(t){const[e,n]=a.useState(null),[i,s]=a.useState(null),r=Ie(),o=Dt("marker"),{children:l,onClick:c,className:f,onMouseEnter:g,onMouseLeave:y,onDrag:v,onDragStart:h,onDragEnd:d,collisionBehavior:b,clickable:M,draggable:C,position:L,title:P,zIndex:A}=t,_=a.Children.count(l);return a.useEffect(()=>{if(!r||!o)return;const x=new o.AdvancedMarkerElement;x.map=r,n(x);let S=null;return _>0&&(S=document.createElement("div"),S.isCustomMarker=!0,x.content=S,s(S)),()=>{var T;x.map=null,(T=S)==null||T.remove(),n(null),s(null)}},[r,o,_]),a.useEffect(()=>{!e||!e.content||_>0||(e.content.className=f||"")},[e,f,_]),K(e,"position",L),K(e,"title",P??""),K(e,"zIndex",A),K(e,"collisionBehavior",b),a.useEffect(()=>{e&&(C!==void 0?e.gmpDraggable=C:v||h||d?e.gmpDraggable=!0:e.gmpDraggable=!1)},[e,C,v,d,h]),a.useEffect(()=>{if(!e)return;const x=M!==void 0||!!c||!!g||!!y;e.gmpClickable=x,x&&e!=null&&e.content&&Ut(e.content)&&(e.content.style.pointerEvents="none",e.content.firstElementChild&&(e.content.firstElementChild.style.pointerEvents="all"))},[e,M,c,g,y]),J(e,"click",c),J(e,"drag",v),J(e,"dragstart",h),J(e,"dragend",d),fe(e==null?void 0:e.element,"mouseenter",g),fe(e==null?void 0:e.element,"mouseleave",y),[e,i]}const $t=a.forwardRef((t,e)=>{const{children:n,style:i,className:s,anchorPoint:r}=t,[o,l]=Zt(t),c=a.useMemo(()=>o?{marker:o}:null,[o]);return a.useImperativeHandle(e,()=>o,[o]),l?k.createElement(_e.Provider,{value:c},he.createPortal(k.createElement(Ht,{anchorPoint:r,styles:i,className:s},n),l)):null});function Jt(){const[t,e]=a.useState(null);return[a.useCallback(i=>{e(i)},[]),t]}const Kt=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"];function Vt(t){const[e,n]=a.useState(null),i=Ie(),{onClick:s,onDrag:r,onDragStart:o,onDragEnd:l,onMouseOver:c,onMouseOut:f}=t,g=B(t,Kt),{position:y,draggable:v}=g;return a.useEffect(()=>{if(!i){i===void 0&&console.error("<Marker> has to be inside a Map component.");return}const h=new google.maps.Marker(g);return h.setMap(i),n(h),()=>{h.setMap(null),n(null)}},[i]),a.useEffect(()=>{if(!e)return;const h=e,d=google.maps.event;return s&&d.addListener(h,"click",s),r&&d.addListener(h,"drag",r),o&&d.addListener(h,"dragstart",o),l&&d.addListener(h,"dragend",l),c&&d.addListener(h,"mouseover",c),f&&d.addListener(h,"mouseout",f),e.setDraggable(!!v),()=>{d.clearInstanceListeners(h)}},[e,v,s,r,o,l,c,f]),a.useEffect(()=>{e&&g&&e.setOptions(g)},[e,g]),a.useEffect(()=>{v||!y||!e||e.setPosition(y)},[v,y,e]),e}a.forwardRef((t,e)=>{const n=Vt(t);return a.useImperativeHandle(e,()=>n,[n]),k.createElement(k.Fragment,null)});const Wt=t=>{var e;const n=(e=a.useContext(_e))==null?void 0:e.marker,i=a.useMemo(()=>document.createElement("div"),[]);return a.useEffect(()=>{var s;if(!n){n===void 0&&console.error("The <Pin> component can only be used inside <AdvancedMarker>.");return}t.glyph&&t.children&&W("The <Pin> component only uses children to render the glyph if both the glyph property and children are present."),a.Children.count(t.children)>1&&W("Passing multiple children to the <Pin> component might lead to unexpected results.");const r=N({},t),o=new google.maps.marker.PinElement(r);t.children&&(o.glyph=i);const l=(s=n.content)==null||(s=s.firstChild)==null?void 0:s.firstChild;for(;l!=null&&l.firstChild;)l.removeChild(l.firstChild);l&&l.appendChild(o.element)},[n,i,t]),he.createPortal(t.children,i)},Ae=({mapData:t,poi:e,markerOptions:n,isRoot:i})=>{const[s,r]=Jt(),[o,l]=a.useState(!1),[c,f]=a.useState(!1),[g,y]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.background,c,o]);const[v,h]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.borderColor,c,o]);const[d,b]=a.useState(void 0);a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.style.glyphColor,c,o]);const[M,C]=a.useState(0);return a.useEffect(()=>{},[t.userInteraction.markerInteraction.enabled,t.userInteraction.markerInteraction.scale,c,o]),isNaN(e.location.lat)||isNaN(e.location.lng)?null:m.jsxs(m.Fragment,{children:[m.jsx($t,{ref:s,title:e.title,position:{lat:Number(e.location.lat),lng:Number(e.location.lng)},onMouseEnter:()=>{t.userInteraction.markerInteraction.enabled&&f(!0)},onMouseLeave:()=>{t.userInteraction.markerInteraction.enabled&&f(!1)},onClick:()=>{l(!o)},className:"pp-marker"+(i===!0?" pp-root-marker":""),zIndex:c||o?1:void 0,children:m.jsx(Wt,{background:g,borderColor:v,glyph:n.glyph,glyphColor:d,scale:(n.scale??1)+(c||o?M:0)})},e.key),!1]})},qt={background:void 0,borderColor:void 0,glyph:void 0,glyphColor:void 0,scale:void 0},Oe=t=>je({},qt,t),Yt=({mapData:t,rows:e})=>{var i;const n=s=>Oe({});return((i=t==null?void 0:t.state)==null?void 0:i.locations)===void 0?null:m.jsx(m.Fragment,{children:t.state.locations.map((s,r)=>s?m.jsx(Ae,{mapData:t,poi:s,markerOptions:n()},s.key):null)})},Xt=t=>{const e=Ke(n=>n.maps[t]);return F.debug("mapData",e),e},Qt=({appId:t,title:e,showToolBar:n,isExploring:i,isBuilderEnabled:s,appLanguage:r,elevation:o,storeTheme:l})=>{const c=ve(),f=Ye();return m.jsx(m.Fragment,{children:n&&m.jsx(Qe,{className:"pp-header",elevation:o,position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:m.jsxs(ye,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[m.jsx(nt,{className:"pp-toolbar-title unselectable",variant:"subtitle1",color:l.customContrastColor,sx:{padding:0},children:e}),m.jsxs(be,{sx:{display:"flex",gap:0,justifyContent:"center",alignItems:"center"},children:[s&&m.jsx(le,{title:"Map Builder",className:"pp-builder-button",children:m.jsx(ce,{sx:{color:"inherit",padding:0},onClick:()=>{c(Re({appId:t}))},children:m.jsx(et,{})})}),i&&m.jsx(le,{title:r.close,children:m.jsx(ce,{sx:{color:"inherit",padding:0},onClick:()=>{c(ze({isActive:!1,appDbId:0})),c(Fe({appId:t})),f(t),c(Be())},children:m.jsx(tt,{})})})]})]})})})},en=({mapRadius:t,setMapRadius:e,radiusUnit:n,setRadiusUnit:i,searchRadius:s})=>m.jsxs(ye,{className:"pp-map-toolbar",sx:{justifyContent:"end",alignItems:"center",gap:"12px","&.pp-map-toolbar":{paddingRight:"12px"}},children:[m.jsxs(lt,{MenuProps:{id:"pp-map-radius"},value:t,sx:{height:"40px",background:"none padding-box rgb(255, 255, 255)","& svg":{width:"40px"}},onChange:r=>{e(Number(r.target.value))},startAdornment:m.jsx(st,{}),children:[...s.map(r=>m.jsx(ct,{value:r,children:r},r))]}),m.jsxs(ut,{value:n,exclusive:!0,onChange:(r,o)=>{o!==null&&i(o)},sx:{height:"40px",background:"none"},children:[m.jsx(ue,{value:"km",children:"KM"}),m.jsx(ue,{value:"miles",children:"Miles"})]})]}),ge=a.lazy(()=>pe(()=>import("./Alert-1.0.61-BDxavmCg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)),tn=a.lazy(()=>pe(()=>import("./Settings-1.0.61-Kp0HHSeJ.js"),__vite__mapDeps([16,17,1,2,3,7,8,9,10,18,19,20,21,5,6,11,12,22,23,24,25,26,27,28,29,30,31,32,14,33,34,35,36,37,38,39,40,41,42,43,44,45,46,4,47]),import.meta.url)),Dn=({appId:t,mapSetup:e,tableStore:n,shortcodeArgs:i})=>{var Y,X,Q,ee,te,ne;F.debug(t,e);const s=ve(),r=Xt(t),o=qe(t),l=Xe(t),c=Ve(),f=Je,g=at(),y=it(g,Ue.table,De.form),[v,h]=a.useState([]),[d,b]=a.useState(!1),[M,C]=a.useState(r.initialLocation.static),[L,P]=a.useState({lat:void 0,lng:void 0});a.useEffect(()=>{r.initialLocation.static||(navigator.geolocation?navigator.geolocation.getCurrentPosition(p=>{p.coords===void 0?(console.error("ERROR - Could not determine user location"),$("Could not determine user location",{variant:"error"})):P({lat:p.coords.latitude,lng:p.coords.longitude}),C(!0)},p=>{console.error("ERROR - ",p),$(p.message,{variant:"error"}),C(!0)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(console.error("Geolocation is not supported by this browser."),$("Geolocation is not supported by this browser",{variant:"error"}),C(!0)))},[]);const[A,_]=a.useState(r.userInteraction.defaultRadius),[x,S]=a.useState(r.userInteraction.distanceUnit),T=a.useMemo(()=>{var O;let p={};try{const u=JSON.parse((O=o==null?void 0:o.app)==null?void 0:O.container[0].cnt_cls);Array.isArray(u)&&u.map(E=>{E.columnName&&E.isSelected!==void 0&&(p[E.columnName]=E.isSelected)})}catch(u){console.error("Invalid JSON - map columns"),console.error(u),$("Invalid JSON, check console",{variant:"error"})}return p},[]),w=a.useMemo(()=>Ge(o),[t]);a.useEffect(()=>{M&&n===void 0&&I()},[M,A,x]);const I=async()=>{var p,O;await We(He.appUrlAppSelect,{client_side:!0,app_id:(p=o==null?void 0:o.src)==null?void 0:p.app_id,cnt_id:(O=o==null?void 0:o.src)==null?void 0:O.cnt_id,col:T,media:[],search_data_types:(()=>{const u={};return Object.keys(T).map(E=>{const j=o==null?void 0:o.columns.filter(Z=>Z.column_name===E);if(Array.isArray(j)&&j.length===1)return u[E]=j[0].data_type}),u})(),search_custom:dt(r.setup.defaultWhere),shortcode_params:i,geo_radius:r.userInteraction.enabled?(()=>{const u=q();return{col:{lat:e.columnLatitude,lng:e.columnLongitude},loc:{lat:u==null?void 0:u.lat,lng:u==null?void 0:u.lng},radius:A,unit:x}})():{}}).then(u=>{var j,Z,re,oe,ie,ae,se;F.debug(u),Array.isArray((j=u==null?void 0:u.data)==null?void 0:j.data)&&h(u.data.data);let E={};if(((re=(Z=o==null?void 0:o.app)==null?void 0:Z.app[0])==null?void 0:re.app_theme)!==void 0&&((ie=(oe=o==null?void 0:o.app)==null?void 0:oe.app[0])==null?void 0:ie.app_theme)!==null&&((se=(ae=o==null?void 0:o.app)==null?void 0:ae.app[0])==null?void 0:se.app_theme)!=="")try{E=JSON.parse(o.app.app[0].app_theme)}catch(we){console.error("Invalid JSON - theme settings"),console.error(we)}E===!1&&(E={}),F.debug(E),s(Ze({appId:t,themeState:E}))}).catch(u=>{console.error(u)})},D=p=>{if(p.toLocaleUpperCase().startsWith("POINT("))return p.substring(6,p.length-1).split(" ")[0]},U=p=>{if(p.toLocaleUpperCase().startsWith("POINT("))return p.substring(6,p.length-1).split(" ")[1]};if(a.useEffect(()=>{const p=n===void 0?v:n.state.mapData;if(Array.isArray(p)){const O=p.filter(u=>u[e.columnLatitude]!==null&&u[e.columnLongitude]!==null&&(e.columnLatitude===e.columnLongitude||!isNaN(u[e.columnLatitude])&&!isNaN(u[e.columnLongitude]))).map(u=>{if(F.debug(u),e.columnLatitude===e.columnLongitude){const E=D(u[e.columnLatitude]),j=U(u[e.columnLongitude]);if(E&&j)return{key:String(u[e.columnLatitude]),location:{lat:Number(E),lng:Number(j)},title:z(r.mapMarkers.marker.title,u),header:z(r.mapMarkers.marker.header,u),content:z(r.mapMarkers.marker.content,u)}}else return{key:String(u[e.columnLatitude])+String(u[e.columnLongitude]),location:{lat:Number(u[e.columnLatitude]),lng:Number(u[e.columnLongitude])},title:z(r.mapMarkers.marker.title,u),header:z(r.mapMarkers.marker.header,u),content:z(r.mapMarkers.marker.content,u)}});s($e({appId:t,property:{locations:O}}))}},[r.mapMarkers.marker,v,n==null?void 0:n.state.mapData]),e.columnLatitude==""||e.columnLongitude=="")return m.jsx(a.Suspense,{children:m.jsx(ge,{severity:"error",message:"Latitude and/or longitude column not defined - use App Manager to fix issue",close:!1})});if(e.apiKey==="")return m.jsx(a.Suspense,{children:m.jsx(ge,{severity:"error",message:"Missing Google Maps API Key - use App Manager to fix issue",close:!1})});const q=()=>{if(r.initialLocation.static&&!isNaN(r.initialLocation.staticMarker.location.lat)&&!isNaN(r.initialLocation.staticMarker.location.lng))return{lat:Number(r.initialLocation.staticMarker.location.lat),lng:Number(r.initialLocation.staticMarker.location.lng)};if(L.lat&&L.lng)return{lat:L.lat,lng:L.lng}},Se=()=>Oe({}),Ne=()=>n!==void 0?"0":r.userInteraction.enabled?"calc(138px + 2em)":"calc(69px + 2em)",Pe=a.useMemo(()=>{var p,O,u;return((u=window.PP_APP_CONFIG[(O=(p=o==null?void 0:o.app)==null?void 0:p.app[0])==null?void 0:O.app_id])==null?void 0:u.hideTitleBar)===!0},[]);return M?m.jsxs(be,{className:"pp-map",sx:{...((Y=r==null?void 0:r.setup)==null?void 0:Y.width)&&((X=r==null?void 0:r.setup)==null?void 0:X.widthUnit)&&((Q=r==null?void 0:r.setup)==null?void 0:Q.height)&&((ee=r==null?void 0:r.setup)==null?void 0:ee.heightUnit)&&{"&.pp-map":{width:r.setup.width+r.setup.widthUnit,height:r.setup.height+r.setup.heightUnit,marginBottom:Ne()}},"&.pp-map div[data-testid=map] > div":{borderRadius:"4px"}},children:[m.jsx(de,{theme:y,children:m.jsx(Ct,{apiKey:e.apiKey,onLoad:()=>{F.debug("Google Maps API has loaded..."),b(!0)},onError:p=>{console.error(p),console.error("Make sure your Google Maps API key is correctly entered in the App Manager and correctly defined in your Google Cloud Platform Console.")},children:d&&m.jsxs(m.Fragment,{children:[n===void 0&&Pe!==!0&&m.jsx(Qt,{appId:t,title:((ne=(te=o==null?void 0:o.app)==null?void 0:te.app[0])==null?void 0:ne.app_title)??"Map Builder",showToolBar:!0,isExploring:(o==null?void 0:o.isExploring)===!0,isBuilderEnabled:w,appLanguage:f,elevation:4,storeTheme:g}),r.userInteraction.enabled&&m.jsx(en,{mapRadius:A,setMapRadius:_,radiusUnit:x,setRadiusUnit:S,searchRadius:r.userInteraction.searchRadius}),m.jsxs(Ee,{mapId:t,mapTypeId:r.setup.startMode,fullscreenControl:l==null?void 0:l.allowFullScreen,defaultCenter:q(),defaultZoom:r.setup.initialZoom,gestureHandling:r.setup.gestureHandling,disableDefaultUI:!r.setup.googleMapsButtons,style:{width:"100%",height:"100%"},children:[r.initialLocation.showStaticMarker&&(r.initialLocation.static||L.lat!==void 0&&L.lng!==void 0)&&m.jsx(Ae,{mapData:r,poi:r.initialLocation.static?r.initialLocation.staticMarker:{key:"user-location",location:{lat:L.lat??0,lng:L.lng??0},title:r.initialLocation.staticMarker.title,header:r.initialLocation.staticMarker.header,content:r.initialLocation.staticMarker.content},markerOptions:Se(),isRoot:!0}),m.jsx(Yt,{mapData:r,rows:v})]})]})})}),w&&m.jsx(a.Suspense,{fallback:m.jsx(rt,{}),children:m.jsx(de,{theme:c,children:m.jsx(tn,{appId:t})})})]}):m.jsx(ot,{})};export{Dn as default};
