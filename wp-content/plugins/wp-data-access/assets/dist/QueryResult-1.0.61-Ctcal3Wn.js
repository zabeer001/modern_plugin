const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./QueryResultTable-1.0.61-DKZ_AvND.js","./cm-1.0.61-D9ug3d5m.js","./redux-1.0.61-CrJ4jvTM.js","./vendor-1.0.61-CN03Eozo.js","./Spinner-1.0.61-khi9zO7Q.js","./lib-1.0.61-DoXQcMHD.js","./loglevel-1.0.61-BZ7XahX3.js","./lodash-1.0.61-C8OpKhUs.js","./moment-1.0.61-C5S46NFB.js","./Typography-1.0.61-Cg0Css-P.js","./QueryResultsResponse-1.0.61-BIFhVVAp.js","./jsonview-1.0.61-Cs94mhmm.js","./QueryResultsResponse-1.0.61-DeIZ423H.css"])))=>i.map(i=>d[i]);
import{_ as D}from"./cmJson-1.0.61-BLURwXOE.js";import{j as t}from"./cm-1.0.61-D9ug3d5m.js";import{r as h}from"./redux-1.0.61-CrJ4jvTM.js";import{n as z,o as M,p as P}from"./index-1.0.61-Cpig8940.js";import{j as Q,G as V,B as H,L as J}from"./jstoxml-1.0.61-B-nwTQWX.js";import{c6 as X}from"./lib-1.0.61-DoXQcMHD.js";import{F as B}from"./FileSaver.min-1.0.61-CuTNgRON.js";import{e as f,p as $,q as W,F as G,E as K,B as N}from"./index-1.0.61-B7tjLD84.js";import{u as U}from"./QueryBuilder-1.0.61-CHDCBAvB.js";import{P as Y}from"./index-1.0.61-D2Hg54qq.js";import{C as Z}from"./index-1.0.61-CxkvNEVW.js";import{e as u}from"./notistack-1.0.61-0awN6uG4.js";import{a as y}from"./hooks-1.0.61-Bklk-gZu.js";import{m as R}from"./StartQueryBuilder-1.0.61-DpIXLFtV.js";import{T as q,a as I}from"./TabPanel-1.0.61-BtYzUOMH.js";import{B as e}from"./Spinner-1.0.61-khi9zO7Q.js";import{I as c}from"./iconBase-1.0.61-C8saXaJ2.js";import{T as tt}from"./TabList-1.0.61-CK8HCF5k.js";import{T as E}from"./Tabs-1.0.61-Bhozjonn.js";import{P as O}from"./ButtonBase-1.0.61-BqsrQx8o.js";import"./vendor-1.0.61-CN03Eozo.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./jstoxml-1.0.61-DkGlThlH.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./ConfirmDialog-1.0.61-BrxkBu_y.js";import"./cjs-1.0.61-D_0erLfe.js";import"./AdminTheme-1.0.61-D8bUxwpM.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./MainQueryBuilder-1.0.61-CAqlR54P.js";import"./ActionsExplorer-1.0.61-Bj7vTxIj.js";import"./RestApi-1.0.61-DdTZ_pIc.js";import"./DatabaseTypeEnum-1.0.61-DeJfpW1u.js";import"./SanitizeComponent-1.0.61-jz3CtJfW.js";import"./dompurify-1.0.61-DhD2mIk-.js";import"./TextField-1.0.61-DyvT2G_W.js";import"./Select-1.0.61-DmroHcG5.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./FormControlLabel-1.0.61-Bu2IQ4da.js";import"./Checkbox-1.0.61-BlN5bjuH.js";import"./SwitchBase-1.0.61-C2xa6JFZ.js";import"./Divider-1.0.61-C8DX248W.js";import"./MenuItem-1.0.61-Bmr1xWyp.js";import"./InputAdornment-1.0.61-23wkGu1k.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./Switch-1.0.61-CRYcdQMV.js";/* empty css                    */import"./ctc-1.0.61-D7oYqo2X.js";import"./useViewHeight-1.0.61-5KT6Wm-M.js";const it=(j,r)=>{const i=()=>{var a;if(Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0){const x=V({filename:j,fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0}),o=H(x)(m());J(x)(o)}},w=()=>{var a;Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0&&B(new Blob([JSON.stringify(m())],{type:"text/json;charset=utf-8"}),`${j}.json`)},p=()=>{var a;if(Array.isArray((a=r==null?void 0:r.status)==null?void 0:a.last_result)&&r.status.last_result.length>0){const x=r.status.last_result.map(n=>{const s={};return Object.keys(n).map(l=>{s[l]=n[l]}),{row:s}}),o=Q.toXML({table:x});B(new Blob([o],{type:"text/plain;charset=utf-8"}),`${j}.xml`)}},m=()=>{const a=[];return Array.isArray(r==null?void 0:r.columns)&&r.columns.map(o=>{if(o.Field&&o.Type){const n=o.Type.indexOf("(")>0?o.Type.substring(0,o.Type.indexOf("(")).toLowerCase():o.Type;X(n)==="number"&&a.push(o.Field)}}),r.status.last_result.map(o=>{const n={};return Object.keys(o).map(s=>{a.includes(s)?n[s]=Number(o[s]):n[s]=o[s]}),n})};return{downloadCsv:i,downloadJson:w,downloadXml:p}},rt=h.lazy(()=>D(()=>import("./QueryResultTable-1.0.61-DKZ_AvND.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)),ot=h.lazy(()=>D(()=>import("./QueryResultsResponse-1.0.61-BIFhVVAp.js"),__vite__mapDeps([10,1,2,3,11,12]),import.meta.url)),ni=({queries:j,queryKey:r,queryResults:i,tabs:w,index:p,setIndex:m})=>{const a=y(),{getQueryKey:x}=U(),{downloadCsv:o,downloadJson:n,downloadXml:s}=it(x(r),i),[l,F]=h.useState("table"),[d,g]=h.useState(!1),L=()=>{var b,C,_,T,k,S,A;return((b=i==null?void 0:i.status)==null?void 0:b.last_error)!==""?t.jsxs(e,{sx:{display:"grid",gridTemplateColumns:"1fr auto",justifyContent:"space-between",alignItems:"center",gap:"5px"},children:[t.jsxs(e,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},children:["ERROR: ",i.status.last_error]}),t.jsxs(e,{children:[t.jsx(Z,{text:i.status.last_error,onCopy:()=>{u("Error successfully copied to clipboard",{variant:"info"})},children:t.jsx(f,{title:"Copy to clipboard",children:t.jsx(c,{size:"small",children:t.jsx(N,{})})})}),t.jsx(f,{title:"Ask AI Assistant for help",children:t.jsx(c,{size:"small",onClick:()=>{a(R({prompt:`This SQL query:

${j[r].query}

Returns the following error:

${i.status.last_error}

Can you help?`,queryKey:r}))},children:t.jsx(Y,{})})})]})]}):i!=null&&i.cmd.trim().startsWith("select")?((_=i==null?void 0:i.status)==null?void 0:_.num_rows)+(((T=i==null?void 0:i.status)==null?void 0:T.num_rows)===1?" row":" rows")+(((k=i==null?void 0:i.status)==null?void 0:k.queries)===null?"":" ("+((A=i==null?void 0:i.status)==null?void 0:A.queries[((S=i==null?void 0:i.status)==null?void 0:S.num_queries)-1][1].toFixed(5))+" sec)"):((C=i==null?void 0:i.status)==null?void 0:C.rows_affected)+" rows affected"},v=b=>t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"11px",position:"absolute",top:b,left:0,right:0},children:[t.jsx(c,{size:"small",color:"primary",disableRipple:!0,onClick:()=>{g(!d)},children:t.jsx(K,{})}),t.jsx(e,{sx:{display:"inline-block",cursor:"pointer"},onClick:()=>{g(!d)},children:l==="table"?"full-screen query result":"full-screen server response"})]});return Object.keys(i).length===0?null:t.jsxs(q,{value:l,children:[t.jsxs(e,{sx:{marginBottom:"2px",display:"grid",gridTemplateColumns:"auto 1fr 1fr 1fr",justifyContent:"space-between",alignItems:"center"},children:[w!==void 0?t.jsxs(e,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"},children:[t.jsx(f,{title:"Previous query",children:t.jsx(c,{disabled:p===0,onClick:()=>{p!==void 0&&m!==void 0&&m(p-1)},children:t.jsx($,{})})}),t.jsx(e,{children:(p??0)+1}),t.jsx(f,{title:"Next query",children:t.jsx(c,{disabled:w-1===p,onClick:()=>{p!==void 0&&m!==void 0&&m(p+1)},children:t.jsx(W,{})})})]}):t.jsx(e,{}),t.jsxs(tt,{onChange:(b,C)=>{g(!1),F(C)},children:[t.jsx(E,{label:"Query Result",value:"table"}),t.jsx(E,{label:"Server Response",value:"response"})]}),t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"11px"},children:[t.jsx(c,{size:"small",color:"primary",disableRipple:!0,onClick:()=>{g(!d)},children:t.jsx(G,{})}),t.jsx(e,{sx:{display:"inline-block",cursor:"pointer"},onClick:()=>{g(!d)},children:l==="table"?"full-screen query result":"full-screen server response"})]}),t.jsxs(e,{sx:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"center"},children:[t.jsx(f,{title:"Export to CSV",children:t.jsx(c,{onClick:()=>{o()},children:t.jsx(z,{})})}),t.jsx(f,{title:"Export to JSON",children:t.jsx(c,{onClick:()=>{n()},children:t.jsx(M,{})})}),t.jsx(f,{title:"Export to XML",children:t.jsx(c,{onClick:()=>{s()},children:t.jsx(P,{})})})]})]}),t.jsxs(e,{className:"pp-sql-query-builder-results",children:[t.jsx(I,{value:"table",keepMounted:!0,sx:{padding:0},children:t.jsxs(O,{sx:{marginTop:"5px",padding:0,backgroundColor:"#ddd",display:"grid",gridTemplateRows:"1fr auto",borderRadius:"4px",...l==="table"&&d&&{width:"calc(100vw - 100px) !important",height:"calc(calc(var(--ppViewHeight, 1vh) * 100) - 100px) !important",position:"fixed",top:0,left:0,zIndex:9999999,margin:0,padding:"50px !important","& table.pp-sql-query-builder-table tbody":{height:"calc(calc(var(--ppViewHeight, 1vh) * 100) - 160px) !important"}}},children:[d&&v("10px"),t.jsx(h.Suspense,{children:t.jsx(rt,{queryResults:i})}),t.jsx(e,{sx:{display:"flex",flexDirection:"row",alignItems:"center",height:"30px",paddingLeft:"5px",paddingRight:"5px",backgroundColor:"#eee",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px"},children:L()})]})}),t.jsx(I,{value:"response",keepMounted:!0,sx:{padding:0},children:t.jsxs(O,{className:"pp-sql-query-builder-response-paper",sx:{marginTop:"5px",padding:"30px",height:"240px",...l==="response"&&d&&{width:"calc(100vw - 100px) !important",height:"calc(calc(var(--ppViewHeight, 1vh) * 100) - 100px) !important",position:"fixed",top:0,left:0,zIndex:9999999,margin:0,padding:"50px !important",backgroundColor:"#ddd"}},children:[d&&v("10px"),t.jsx(e,{sx:{height:"240px",overflow:"auto","& code":{padding:0,margin:0,backgroundColor:"transparent"},...l==="response"&&d&&{height:"calc(calc(var(--ppViewHeight, 1vh) * 100) - 145px) !important",backgroundColor:"#fff",padding:"20px !important",borderRadius:"4px"}},className:"pp-sql-query-builder-response",children:t.jsx(h.Suspense,{children:t.jsx(ot,{queryResults:i})})})]})})]})]})};export{ni as default};
