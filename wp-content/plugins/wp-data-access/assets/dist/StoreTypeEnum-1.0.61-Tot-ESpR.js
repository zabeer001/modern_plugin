import{l as r,aj as de,F as ge,A as F,a5 as _,t as K,ak as ae,al as he,r as D,am as Ne,an as Se,a as _e,a9 as Q,a6 as ve,a7 as Pe,ao as ye,G as Ce,ap as Je,S as xe,aq as we,ar as Fe,as as De,at as Ie,au as Re,a8 as Ue}from"./lib-1.0.61-DoXQcMHD.js";import{a as Be}from"./hooks-1.0.61-Bklk-gZu.js";const Ee=(i,I)=>({app_id:i,cnt_id:I}),Me=(i,I)=>({dbs:i,tbl:I}),Ve=(i,I)=>{r.debug(i,I);const O=Be(),Oe=(p,t,e,S)=>{var U,u,m,J,w,z,T,x,g,d,v,B,E,M,j,q,G,V,Y,k,L,s,o,b,W,Z,$,ee,le,se,ne,te,re,oe,ue,ce,me,ie,pe,fe,be;r.debug(e);const N=(U=e.access.insert)==null?void 0:U.some(n=>n.toUpperCase()==="POST"),P=(u=e.access.update)==null?void 0:u.some(n=>n.toUpperCase()==="POST"),f=(m=e.access.delete)==null?void 0:m.some(n=>n.toUpperCase()==="POST");e.src=Me(p,t),e.privs={select:!0,insert:N,update:P,delete:f};let l={};((z=(w=(J=e==null?void 0:e.settings)==null?void 0:J.ui)==null?void 0:w.global)==null?void 0:z.table)!==!1?(l=_({},K,(g=(x=(T=e==null?void 0:e.settings)==null?void 0:T.ui)==null?void 0:x.global)==null?void 0:g.table),(j=(M=(E=(B=(v=(d=e==null?void 0:e.settings)==null?void 0:d.ui)==null?void 0:v.global)==null?void 0:B.table)==null?void 0:E.table)==null?void 0:M.pagination)!=null&&j.rowsPerPage&&(l.table.pagination.rowsPerPage=[...e.settings.ui.global.table.table.pagination.rowsPerPage]),(k=(Y=(V=(G=(q=e==null?void 0:e.settings)==null?void 0:q.ui)==null?void 0:G.global)==null?void 0:V.table)==null?void 0:Y.table)!=null&&k.defaultOrderBy&&(l.table.defaultOrderBy=[...e.settings.ui.global.table.table.defaultOrderBy])):l=_({},K,{table:{transactions:{insert:N,update:P,delete:f},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(L=e==null?void 0:e.privs)==null?void 0:L.delete}}});const y=D(l.columns);for(let n=0;n<l.columns.length;n++)if(l.columns[n].computedField===void 0&&e.columns.filter(a=>a.column_name===l.columns[n].columnName).length===0){const a=y.findIndex(H=>H.columnName===l.columns[n].columnName);a!==-1&&y.splice(a,1)}for(let n=0;n<e.columns.length;n++)l.columns.filter(a=>a.columnName===e.columns[n].column_name).length===0&&y.push(D(ae(e.columns[n].column_name,e.table_labels[e.columns[n].column_name]??e.columns[n].column_name)));l.columns=y,l.table.largeTableSupport.saved===Ne.AUTO?l.table.largeTableSupport.actual=Se(e):l.table.largeTableSupport.actual=l.table.largeTableSupport.saved,r.debug(l);let c={...Q};((b=(o=(s=e==null?void 0:e.settings)==null?void 0:s.ui)==null?void 0:o.global)==null?void 0:b.form)!==!1&&(c=_({},Q,($=(Z=(W=e==null?void 0:e.settings)==null?void 0:W.ui)==null?void 0:Z.global)==null?void 0:$.form));const h=D(c.columns);for(let n=0;n<c.columns.length;n++)if(c.columns[n].computedField===void 0&&e.columns.filter(a=>a.column_name===c.columns[n].columnName).length===0){const a=h.findIndex(H=>H.columnName===c.columns[n].columnName);a!==-1&&h.splice(a,1)}for(let n=0;n<e.columns.length;n++)c.columns.filter(a=>a.columnName===e.columns[n].column_name).length===0&&h.push(D(he(e.columns[n].column_name,e.table_labels[e.columns[n].column_name]??e.columns[n].column_name)));c.columns=h,r.debug(c);const C=Je.getSelectors().selectSelected(xe.getState().explorer);r.debug("selected",C),C&&C[p]==="wp"&&((le=(ee=e==null?void 0:e.settings)==null?void 0:ee.wp)==null?void 0:le.tables)!==void 0&&Array.isArray(e.settings.wp.tables)&&e.settings.wp.tables.includes(t)&&(c.form={...we},c.form.preserveSpacesOnUpdate=!0);let A={};if(((te=(ne=(se=e==null?void 0:e.settings)==null?void 0:se.ui)==null?void 0:ne.global)==null?void 0:te.theme)!==void 0&&((ue=(oe=(re=e==null?void 0:e.settings)==null?void 0:re.ui)==null?void 0:oe.global)==null?void 0:ue.theme)!==null&&((ie=(me=(ce=e==null?void 0:e.settings)==null?void 0:ce.ui)==null?void 0:me.global)==null?void 0:ie.theme)!=="")try{A=JSON.parse((be=(fe=(pe=e==null?void 0:e.settings)==null?void 0:pe.ui)==null?void 0:fe.global)==null?void 0:be.theme)}catch(n){console.error("Invalid JSON - theme settings"),console.error(n)}A===!1&&(A={});const R=_({},Fe,A);return X(e,l,c,R,S===!0)},Ae=(p,t,e,S,N,P)=>{var B,E,M,j,q,G,V,Y,k,L;r.debug(p,t,e,S,N);const f=t.app.app[0];r.debug(f);const l=t.app.container[0];r.debug(l);let y={};try{y=JSON.parse(f.app_settings)}catch(s){console.error("Invalid JSON - app settings"),console.error(s)}r.debug(y);let c={};try{c=JSON.parse(l.cnt_cls)}catch(s){console.error("Invalid JSON - app columns"),console.error(s)}r.debug(c);const h=f.app_type,C=Number(h)===F.DATAENTRY||Number(h)===F.REGISTRATION,A=Number(h)===F.DATAENTRY||Number(h)===F.REGISTRATION||Number(h)===F.UPDATEFORM,R=Number(h)===F.DATAENTRY;r.debug(C,A,R),t.src=Ee(p,l.cnt_id),t.privs={select:!0,insert:C,update:A,delete:R};const U=_({},K,{table:{transactions:{insert:C,update:A,delete:R},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(B=t==null?void 0:t.privs)==null?void 0:B.delete}}});r.debug(U);let u={};if(l.cnt_table!==void 0&&l.cnt_table!==null&&l.cnt_table!=="")try{u=JSON.parse(l.cnt_table)}catch(s){console.error("Invalid JSON - table settings"),console.error(s)}r.debug(u);const m=_({},U,u);(M=(E=u==null?void 0:u.table)==null?void 0:E.pagination)!=null&&M.rowsPerPage&&(m.table.pagination.rowsPerPage=[...u.table.pagination.rowsPerPage]),(j=u==null?void 0:u.table)!=null&&j.defaultOrderBy&&(m.table.defaultOrderBy=[...u.table.defaultOrderBy]),r.debug(m);const J=[],w=[],z={};for(let s=0;s<c.length;s++)if(c[s].isSelected===!0){let o=!0;const b=ae(c[s].columnName,t.table_labels[c[s].columnName]??c[s].columnName,o);J.push(b);const W=he(c[s].columnName,t.form_labels[c[s].columnName]??c[s].columnName,o);w.push(W),z[c[s].columnName]=W}r.debug(J,w);const T=D(m.columns);J.map(s=>{T.filter(o=>o.columnName===s.columnName).length===0&&T.push(s)});for(let s=0;s<m.columns.length;s++)if(m.columns[s].computedField===void 0&&J.filter(o=>o.columnName===m.columns[s].columnName).length===0){const o=T.findIndex(b=>b.columnName===m.columns[s].columnName);o!==-1&&T.splice(o,1)}if(m.columns=T,m.table.largeTableSupport.saved===Ne.AUTO?m.table.largeTableSupport.actual=Se(t):m.table.largeTableSupport.actual=m.table.largeTableSupport.saved,r.debug(m),(t==null?void 0:t.isRelationSelectionTable)===!0&&(u==null?void 0:u.columns)!==void 0&&Array.isArray(u.columns)){const s=[];u.columns.map(o=>{if(o.columnName.startsWith(_e.relationTablePrefix)){const b={...o};b.columnName=o.columnName.substring(_e.relationTablePrefix.length),s.push(b)}}),m.columns=[...s]}r.debug(m);let x={};if((l==null?void 0:l.cnt_form)!==void 0&&(l==null?void 0:l.cnt_form)!==null&&(l==null?void 0:l.cnt_form)!==""||t.useRform===!0&&(l==null?void 0:l.cnt_rform)!==void 0&&(l==null?void 0:l.cnt_rform)!==null&&(l==null?void 0:l.cnt_rform)!=="")try{t.useRform===!0?x=JSON.parse(l.cnt_rform):x=JSON.parse(l.cnt_form)}catch(s){console.error("Invalid JSON - form settings"),console.error(s)}r.debug(x);const g=_({},Q,x);r.debug(g);const d=D(g.columns);w.map(s=>{d.filter(o=>o.columnName===s.columnName).length===0&&d.push(s)});for(let s=0;s<g.columns.length;s++)if(g.columns[s].computedField===void 0&&t.columns_sorted[g.columns[s].columnName]===void 0){const o=d.findIndex(b=>b.columnName===g.columns[s].columnName);o!==-1&&d.splice(o,1)}g.columns=d,Array.isArray((G=(q=t==null?void 0:t.settings)==null?void 0:q.wp)==null?void 0:G.tables)&&t.settings.wp.tables.includes(l==null?void 0:l.cnt_tbl)&&(g.form.preserveSpacesOnUpdate=!0),r.debug(g);let v={};if((f==null?void 0:f.app_theme)!==void 0&&(f==null?void 0:f.app_theme)!==null&&(f==null?void 0:f.app_theme)!=="")try{v=JSON.parse(f.app_theme)}catch(s){console.error("Invalid JSON - theme settings"),console.error(s)}if(v===!1&&(v={}),r.debug(v),N!==void 0&&(t.appRootId=N),((Y=(V=u==null?void 0:u.table)==null?void 0:V.charts)==null?void 0:Y.enabled)===!0){let s={};if((l==null?void 0:l.cnt_chart)!==void 0&&(l==null?void 0:l.cnt_chart)!==null&&(l==null?void 0:l.cnt_chart)!=="")try{s=JSON.parse(l.cnt_chart)}catch(b){console.error("Invalid JSON - chart settings"),console.error(b)}s===!1&&(s={}),r.debug(s);const o=_({},ve,s);r.debug(o),O(Pe({appId:i,chartState:o}))}if(((L=(k=u==null?void 0:u.table)==null?void 0:k.maps)==null?void 0:L.enabled)===!0){let s={};if((l==null?void 0:l.cnt_map)!==void 0&&(l==null?void 0:l.cnt_map)!==null&&(l==null?void 0:l.cnt_map)!=="")try{s=JSON.parse(l.cnt_map)}catch(b){console.error("Invalid JSON - chart settings"),console.error(b)}s===!1&&(s={}),r.debug(s);const o=_({},ye,s);O(Ce({appId:i,mapState:o}))}return X(t,m,g,v,e===!0,P)},Te=(p,t)=>{r.debug(p);const e=p.app.app[0];r.debug(e);let S={};try{S=JSON.parse(e.app_settings)}catch(N){console.error("Invalid JSON - app settings"),console.error(N)}return r.debug(S),O(de({appId:i,apps:p.app.apps,titles:p.app.titles,appSettings:S})),O(ge({appId:i,metaData:{...p,isExploring:t??!1}})),!0},X=(p,t,e,S,N,P)=>(r.debug(p),O(ge({appId:i,metaData:{...p}})),O(De({appId:i,tableState:t,tableAccess:{insert:p.privs.insert,update:p.privs.update,delete:p.privs.delete},isView:Ie(p),exploring:N})),O(Re({appId:i,formState:e})),O(Ue({appId:i,themeState:S})),P!==void 0&&P(),!0);return{prepareAdminStore:Oe,prepareAppStore:Ae,prepareApp:Te}};var je=(i=>(i[i.ADMIN=0]="ADMIN",i[i.APP=1]="APP",i))(je||{});export{Ee as D,je as S,Ve as u};
