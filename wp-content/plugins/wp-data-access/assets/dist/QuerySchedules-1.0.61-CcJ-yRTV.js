import{j as e}from"./cm-1.0.61-D9ug3d5m.js";import{r as l}from"./redux-1.0.61-CrJ4jvTM.js";import{P as H,b as M,c as O}from"./TabPanel-1.0.61-BtYzUOMH.js";import{e as q,ab as P,l as Q}from"./index-1.0.61-B7tjLD84.js";import{P as A}from"./PremiumFeature-1.0.61-BxBWJ4MJ.js";import{u as I}from"./MainQueryBuilder-1.0.61-CAqlR54P.js";import{d as R}from"./dayjs.min-1.0.61-21Xi_c_9.js";import{C as Y}from"./ConfirmDialog-1.0.61-BrxkBu_y.js";import{c as z,f as E}from"./QueryBuilder-1.0.61-CHDCBAvB.js";import{D as F}from"./QueryToolbar-1.0.61-BeTU-Hzo.js";import{e as S}from"./notistack-1.0.61-0awN6uG4.js";import{l as $}from"./lib-1.0.61-DoXQcMHD.js";import{I as N}from"./iconBase-1.0.61-C8saXaJ2.js";import{P as L}from"./Menu-1.0.61-D2OtRuzX.js";import{C as W,b as G,a as J,c as U}from"./CardHeader-1.0.61-gDG-f_-J.js";import{B as k}from"./Spinner-1.0.61-khi9zO7Q.js";import{T as V,b as B,c as s,a as X}from"./TableRow-1.0.61-70IJJfOz.js";import{T as Z}from"./TableHead-1.0.61-urAqheBu.js";import{B as w}from"./cjs-1.0.61-D_0erLfe.js";import"./vendor-1.0.61-CN03Eozo.js";import"./InputAdornment-1.0.61-23wkGu1k.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./Select-1.0.61-DmroHcG5.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./index-1.0.61-Cpc7oUnN.js";import"./AdminTheme-1.0.61-D8bUxwpM.js";import"./TextField-1.0.61-DyvT2G_W.js";import"./cmJson-1.0.61-BLURwXOE.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./hooks-1.0.61-Bklk-gZu.js";import"./StartQueryBuilder-1.0.61-DpIXLFtV.js";import"./useViewHeight-1.0.61-5KT6Wm-M.js";import"./ActionsExplorer-1.0.61-Bj7vTxIj.js";import"./RestApi-1.0.61-DdTZ_pIc.js";import"./DatabaseTypeEnum-1.0.61-DeJfpW1u.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./index-1.0.61-Cpig8940.js";import"./SanitizeComponent-1.0.61-jz3CtJfW.js";import"./dompurify-1.0.61-DhD2mIk-.js";import"./FormControlLabel-1.0.61-Bu2IQ4da.js";import"./Checkbox-1.0.61-BlN5bjuH.js";import"./SwitchBase-1.0.61-C2xa6JFZ.js";import"./Divider-1.0.61-C8DX248W.js";import"./MenuItem-1.0.61-Bmr1xWyp.js";import"./TabList-1.0.61-CK8HCF5k.js";import"./Tabs-1.0.61-Bhozjonn.js";import"./Switch-1.0.61-CRYcdQMV.js";/* empty css                    */import"./index-1.0.61-D2Hg54qq.js";import"./index-1.0.61-CxkvNEVW.js";import"./ctc-1.0.61-D7oYqo2X.js";import"./react-number-format.es-1.0.61-3K4hYgeH.js";import"./ToggleButtonGroup-1.0.61-31GAUuTm.js";import"./AdapterDayjs-1.0.61-BqcEbIuB.js";import"./useMobilePicker-1.0.61-Dvb2yEEp.js";import"./index-1.0.61-CRnugLvI.js";import"./visuallyHidden-1.0.61-Dan1xhjv.js";import"./ListItem-1.0.61-t1ycs9HY.js";import"./Chip-1.0.61-C6TjQKDp.js";import"./DateTimePicker-1.0.61-B22uat3C.js";import"./timeViewRenderers-1.0.61-Cu86BQXJ.js";import"./dateViewRenderers-1.0.61-7dkntk_V.js";import"./FileSaver.min-1.0.61-CuTNgRON.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";const K=m=>{const t=I(),[p,j]=l.useState([]),g=()=>{var u,c,h,x,r,o,i,n,v;const a=[],b=t.queries[m].queryName,d=t.queries[m].access;for(let y in t.cron.cron)if(t.cron.cron[y].wpda_run_scheduled_sql){const f=t.cron.cron[y].wpda_run_scheduled_sql,C=Object.keys(f)[0],D=(h=(c=(u=f[C])==null?void 0:u.args)==null?void 0:c.args)==null?void 0:h.name,T=(o=(r=(x=f[C])==null?void 0:x.args)==null?void 0:r.args)==null?void 0:o.access,_=(v=(n=(i=f[C])==null?void 0:i.args)==null?void 0:n.args)==null?void 0:v.params;D===b&&T===d&&a.push({dt:R.unix(Number(y)).format("YYYY-MM-DD HH:mm:ss"),name:D,access:T,params:_})}j(a)};return l.useEffect(()=>{g()},[t.cron.cron]),p},gr=({queryKey:m,queryBuilderState:t})=>{const p=K(m),j=z(),[g,a]=l.useState({}),[b,d]=l.useState(!1),[u,c]=l.useState(!1),h=r=>r?Object.keys(r).map(o=>`${o} = ${r[o]}`).join(", "):"",x=r=>{var o;if((o=r==null?void 0:r.notify)!=null&&o.email){let i=r.notify.email;const n=[];return r.notify.csv&&n.push("csv"),r.notify.json&&n.push("json"),r.notify.xml&&n.push("xml"),n.length>0?i+" ("+n.join(",")+")":i}else return""};return e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"popover",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Schedule query",children:e.jsx(N,{...M(r),sx:{color:"inherit","&.Mui-disabled":{color:"grey"}},children:e.jsx(P,{})})}),e.jsx(L,{...O(r),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(W,{sx:{padding:"4px"},children:[e.jsx(G,{title:"Schedule Query",sx:{paddingBottom:"4px"}}),e.jsxs(J,{children:[p.length===0?e.jsx(k,{children:"This query is currently not scheduled."}):e.jsx(k,{sx:{marginTop:0,border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px",padding:"0 0 10px 0"},children:e.jsxs(V,{sx:{width:"100%","& *":{border:"none !important"},"& td":{padding:"10px",lineHeight:1},"& th":{padding:"10px",fontWeight:"bold"}},children:[e.jsx(Z,{children:e.jsxs(B,{children:[e.jsx(s,{}),e.jsx(s,{children:"Next run"}),e.jsx(s,{children:"Parameters"}),e.jsx(s,{children:"Notify"}),e.jsx(s,{})]})}),e.jsxs(X,{children:[...p.map(o=>{var i;return e.jsxs(B,{children:[e.jsx(s,{sx:{paddingLeft:"20px !important"},children:e.jsx(P,{})}),e.jsx(s,{children:o.dt}),e.jsx(s,{children:h((i=o.params)==null?void 0:i.params)}),e.jsx(s,{children:x(o.params)}),e.jsx(s,{sx:{paddingRight:"20px !important"},children:e.jsx(q,{title:"Delete",children:e.jsx(N,{color:"error",size:"small",onClick:()=>{a(o.params),d(!0)},children:e.jsx(Q,{})})})})]},o.dt)})]})]})}),e.jsx(A,{})]}),e.jsxs(U,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"space-between",padding:"8px 16px 16px 16px"},children:[e.jsx(w,{color:"primary",variant:"contained",onClick:()=>{c(!0)},children:"Schedule"}),e.jsx(w,{color:"primary",variant:"contained",onClick:()=>{r.close()},children:"Done"})]})]})})]})}),e.jsx(F,{queryKey:m,queryBuilderState:t,scheduling:u,setScheduling:c,limit:"100"}),e.jsx(Y,{title:"Delete Schedule?",message:"Are you sure you want to delete this schedule? This action cannot be undone!",open:b,setOpen:d,onConfirm:()=>{E(t.queries[m].queryName,t.queries[m].access,g,r=>{$.debug(r),(r==null?void 0:r.code)==="ok"&&(r!=null&&r.message)?(j(),S(r.message,{variant:"success"})):(console.error("Invalid response"),S("Invalid response",{variant:"error"}))},r=>{console.error(r),S(r,{variant:"error"})})}})]})};export{gr as default};
