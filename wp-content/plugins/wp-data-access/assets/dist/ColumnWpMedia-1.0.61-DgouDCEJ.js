import{j as s}from"./cm-1.0.61-D9ug3d5m.js";import{r as T}from"./redux-1.0.61-CrJ4jvTM.js";import{l as e,C as g,cJ as H,bz as S,c6 as z,cS as I}from"./lib-1.0.61-DoXQcMHD.js";import{a as C}from"./hooks-1.0.61-Bklk-gZu.js";import{l as U,m as $,n as q,o as D,p as G}from"./index-1.0.61-Cpc7oUnN.js";import{u as K}from"./useLocaleMrt-1.0.61-C3Pa4C9e.js";import{B as Q}from"./Spinner-1.0.61-khi9zO7Q.js";import{F as L,b as X}from"./TextField-1.0.61-DyvT2G_W.js";import{B as _}from"./cjs-1.0.61-D_0erLfe.js";import"./vendor-1.0.61-CN03Eozo.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./iconBase-1.0.61-C8saXaJ2.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./Languages-1.0.61-BxgPwugF.js";import"./useLocaleUd-1.0.61-DEEqF_bH.js";import"./RestApi-1.0.61-DdTZ_pIc.js";import"./notistack-1.0.61-0awN6uG4.js";import"./Select-1.0.61-DmroHcG5.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./index-1.0.61-B7tjLD84.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";const Y="Upload or select %s from your WordPress media library",kr=({appId:m,columnName:l,columnValue:y,columnMetaData:c,onColumnChange:F,columnMedia:d,mediaType:u,locale:E,language:f,formMode:v,storeColumn:n,storeTable:A})=>{e.debug(m,l,y,c,d,u);const J=T.useRef(null),W=C(),{mrtLocale:M,mrtIsLoading:N}=K((f==null?void 0:f.code)??g.defaultLanguage.code),P=r=>{if(e.debug(r),r!=null&&r.id&&(r!=null&&r.url)&&(r!=null&&r.mime)&&(r!=null&&r.title))return{value:r.id,media:{url:r.url,mime_type:r.mime,title:r.title}}},V=()=>{e.debug("update media");const r=z(c.data_type)!=="number";e.debug(r);let t="media",a="";switch(u){case"WP-Image":t="images(s)",a="image";break;case"WP-Audio":t="audio",a="audio";break;case"WP-Video":t="video(s)",a="video";break}e.debug(t,a);const p=window.wp.media({title:Y.replace("%s",t),button:{text:"Select"},library:{type:a},multiple:r,render:!1});e.debug("frame",p),p.on("select",function(){const o=[];if(r){const i=p.state().get("selection").toJSON();e.debug(i),i.map(k=>{e.debug(k);const w=P(k);w&&o.push(w)})}else{const i=P(p.state().get("selection").first().toJSON());i&&o.push(i)}e.debug("media",o);const x=[],h=[];for(let i=0;i<o.length;i++)x.push(o[i].value),h.push(JSON.stringify(o[i].media));e.debug(x,h),F(l,x.toString()),W(I({appId:m,columnName:l,columnValue:h}))}),p.open(),A.formModal&&window.document.body.classList.add("pp-media-modal")},B=()=>{e.debug("delete media"),F(l,null),W(I({appId:m,columnName:l,columnValue:[]}))},R=r=>{switch(u){case"WP-Image":return s.jsx("img",{src:r.url,title:r.title,alt:r.title});case"WP-Attachment":{const t=r.mime_type.split("/");return s.jsxs("a",{href:r.url,title:r.title,target:"_blank",className:"pp-hyperlink",children:[s.jsxs("div",{children:[t[0]==="image"&&s.jsx(U,{}),t[0]==="audio"&&s.jsx($,{}),t[0]==="video"&&s.jsx(q,{}),t[0]==="application"?t[1]==="pdf"?s.jsx(D,{}):s.jsx(G,{}):s.jsx(s.Fragment,{})]}),s.jsx("div",{className:"link-label",children:r.title})]})}case"WP-Audio":return s.jsx("audio",{controls:!0,children:s.jsx("source",{src:r.url,type:r.mime_type})});case"WP-Video":return s.jsx("video",{controls:!0,children:s.jsx("source",{src:r.url,type:r.mime_type})})}};return N?null:s.jsxs("fieldset",{className:`pp-fieldset media ${u}`,children:[s.jsx("legend",{children:c.formLabel}),s.jsxs(Q,{children:[s.jsxs(L,{fullWidth:!0,children:[d==null?void 0:d.map(r=>{try{if(r===null||r==="")return null;const t=JSON.parse(r);return t!=null&&t.url?s.jsx("div",{ref:J,className:"content",children:R(t)},t.url):null}catch(t){return console.error("Invalid media properties",t),s.jsx("span",{children:"Error reading media"})}}),s.jsx("input",{type:"hidden",value:y??""})]}),n.hint&&n.hint.trim()!==""&&s.jsx(L,{sx:{marginTop:"20px"},children:s.jsx(X,{sx:{marginLeft:0},children:H(n,"")})})]}),s.jsxs("div",{className:"actions",children:[s.jsx(_,{variant:"outlined",onClick:V,disabled:!g.appPlugin||v===S.VIEW||n.updatable===!1,children:M.select}),s.jsx(_,{variant:"outlined",onClick:B,disabled:!g.appPlugin||v===S.VIEW||n.updatable===!1,children:E.delete})]})]})};export{kr as default};
