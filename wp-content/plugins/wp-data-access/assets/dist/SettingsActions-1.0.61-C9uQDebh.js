import{j as s}from"./cm-1.0.61-D9ug3d5m.js";import{r as a}from"./redux-1.0.61-CrJ4jvTM.js";import{b as ce}from"./RestApi-1.0.61-DdTZ_pIc.js";import{l as j,a as c,aL as J,aJ as _,ai as U}from"./lib-1.0.61-DoXQcMHD.js";import{u as pe,T as p,d as ue,e as de,b as me,a as xe}from"./ActionsAdmin-1.0.61-DGFUYQF4.js";import{e as i}from"./notistack-1.0.61-0awN6uG4.js";import{a as he}from"./hooks-1.0.61-Bklk-gZu.js";import{C as k}from"./ConfirmDialog-1.0.61-BrxkBu_y.js";import{B as n,S as ge}from"./Spinner-1.0.61-khi9zO7Q.js";import{j as je}from"./index-1.0.61-Cpc7oUnN.js";import{C as fe}from"./index-1.0.61-CxkvNEVW.js";import{u as ve}from"./useExplorer-1.0.61-BwAinfQj.js";import{B as m}from"./cjs-1.0.61-D_0erLfe.js";import{F as E,I as $,T as L,b as we}from"./TextField-1.0.61-DyvT2G_W.js";import{S as R}from"./Select-1.0.61-DmroHcG5.js";import{M as u}from"./MenuItem-1.0.61-Bmr1xWyp.js";import{F as z}from"./FormControlLabel-1.0.61-Bu2IQ4da.js";import{S as X}from"./Switch-1.0.61-CRYcdQMV.js";import{e as ye}from"./index-1.0.61-B7tjLD84.js";import"./vendor-1.0.61-CN03Eozo.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./AdminTheme-1.0.61-D8bUxwpM.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./iconBase-1.0.61-C8saXaJ2.js";import"./ctc-1.0.61-D7oYqo2X.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./SwitchBase-1.0.61-C2xa6JFZ.js";const rs=({dbs:r,tbl:t,typ:l,metaData:o})=>{var W,q,V,M,G,O,Q,H;j.debug(r,t,l,o);const x=he(),[h,K]=a.useState("sql"),[y,Y]=a.useState(!0),[v,Z]=a.useState(""),[N,D]=a.useState(r),[b,ee]=a.useState(""),[C,se]=a.useState(!0),[ne,I]=a.useState(!1),[re,P]=a.useState(!1),[ie,A]=a.useState(!1),[oe,S]=a.useState(!1),te=ve(),f=pe(),B=a.useMemo(()=>{const e=[];for(const d in f)e.push(d);return e},[f]);j.debug(B);const g=te.selected,[w,F]=a.useState(f[r].pdsDbs===!0?((V=(q=(W=o==null?void 0:o.settings)==null?void 0:W.wp)==null?void 0:q.connect)==null?void 0:V.interval)??"":""),[T,ae]=a.useState(f[r].pdsDbs===!0?((O=(G=(M=o==null?void 0:o.settings)==null?void 0:M.wp)==null?void 0:G.connect)==null?void 0:O.unit)??"":""),le=e=>{ce.post(o.settings.wp.homea+"?action=wpda_pds_update_interval",e,{headers:{"Content-Type":"multipart/form-data"}}).then(d=>{console.error(e,d)}).catch(d=>{console.error("error",d)})};return s.jsxs(s.Fragment,{children:[s.jsxs(n,{sx:{margin:0,padding:0,"& .pp-action":{display:"grid",gridTemplateColumns:"150px 1fr",alignItems:"center",margin:0,padding:"30px",borderBottom:"1px solid #ddd"},"& .pp-action button":{width:"120px"}},children:[l===p.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{action:o.settings.wp.home+"?action=wpda_export",method:"post",target:"_blank",children:[s.jsx("input",{type:"hidden",name:"type",value:"table"}),s.jsx("input",{type:"hidden",name:"wpdaschema_name",value:r}),s.jsx("input",{type:"hidden",name:"table_names",value:t}),s.jsx("input",{type:"hidden",name:"format_type",value:h}),s.jsx("input",{type:"hidden",name:"include_table_settings",value:h==="sql"&&y?"on":"off"}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:o.settings.wp.aonce.split("-")[0]}),s.jsx(m,{variant:"contained",type:"submit",children:"Export"})]})}),s.jsxs(n,{sx:{display:"grid"},children:[s.jsxs(E,{children:[s.jsx($,{variant:"outlined",children:"Export to"}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},label:"Export to",value:h,onChange:e=>{K(e.target.value)},children:[s.jsx(u,{value:"sql",children:"SQL"},"sql"),s.jsx(u,{value:"csv",children:"CSV"},"csv"),s.jsx(u,{value:"json",children:"JSON"},"json"),s.jsx(u,{value:"excel",children:"Excel"},"excel"),s.jsx(u,{value:"xml",children:"XML"},"xml")]})]}),s.jsx(z,{sx:{visibility:h==="sql"?"visible":"hidden",height:h==="sql"?"auto":0,marginTop:h==="sql"?"10px":0,marginLeft:0},control:s.jsx(X,{checked:y,onClick:e=>{Y(!y),e.stopPropagation()}}),label:"With table settings",labelPlacement:"end"})]})]}),g[r]!=="system"&&(g[r]!=="wp"||!o.settings.wp.tables.includes(t))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(m,{variant:"contained",onClick:()=>{t!==v&&v.trim()!==""?I(!0):i("Nothing to rename",{variant:"error"})},children:"Rename"})}),s.jsx(n,{children:s.jsx(L,{label:l===p.TABLE?"New table name":"New view name",value:v,onChange:e=>{Z(e.target.value)},fullWidth:!0})})]}),l===p.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsxs(n,{children:[s.jsx(m,{variant:"contained",onClick:()=>{b.trim()!==""?(S(!0),ue(r,N,t,b,C,e=>{if(j.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":x(_({dbs:r})),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:console.error(e),i(e.message??c.contactSupport,{variant:"error"})}else console.error(e),i(c.contactSupport,{variant:"error"});S(!1)},e=>{console.error("error",e),i(e??c.contactSupport,{variant:"error"}),S(!1)})):i("Nothing to rename",{variant:"error"})},children:"Copy"}),s.jsx(z,{control:s.jsx(X,{checked:C,onClick:e=>{se(!C),e.stopPropagation()}}),label:"Copy data",labelPlacement:"end",sx:{height:"56px"}}),s.jsx(n,{sx:{display:oe?"block":"none","& > div":{marginRight:"30px"},"& span.MuiCircularProgress-root, svg":{height:"20px !important",width:"20px !important"}},children:s.jsx(ge,{title:"Copying..."})})]}),s.jsxs(n,{sx:{display:"grid",gridGap:"10px"},children:[s.jsxs(E,{fullWidth:!0,children:[s.jsx($,{variant:"outlined",children:"To database"}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},label:"To database",value:N,onChange:e=>{D(e.target.value)},children:[...B.map(e=>s.jsx(u,{value:e,children:e},e))]})]}),s.jsx(L,{label:"To table name",value:b,onChange:e=>{ee(e.target.value)},fullWidth:!0})]})]}),l===p.TABLE&&g[r]!=="system"&&(g[r]!=="wp"||!o.settings.wp.tables.includes(t))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(m,{variant:"contained",onClick:()=>{P(!0)},children:"Truncate"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx("span",{children:"Deletes all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),g[r]!=="system"&&(g[r]!=="wp"||!o.settings.wp.tables.includes(t))&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(m,{variant:"contained",onClick:()=>{A(!0)},children:"Drop"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[l==p.VIEW?s.jsx("span",{children:"Deletes view permanently."}):s.jsx("span",{children:"Deletes table and all data permanently."}),s.jsx("strong",{children:"This action cannot be undone!"})]})]}),l===p.TABLE&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsxs("form",{method:"POST",action:o.settings.wp.home+"?page=wpda_designer",children:[s.jsx("input",{type:"hidden",name:"action",value:"edit"}),s.jsx("input",{type:"hidden",name:"action2",value:"init"}),s.jsx("input",{type:"hidden",name:"wpda_schema_name",value:r}),s.jsx("input",{type:"hidden",name:"wpda_schema_name_re",value:r}),s.jsx("input",{type:"hidden",name:"wpda_table_name",value:t}),s.jsx("input",{type:"hidden",name:"wpda_table_name_re",value:t}),s.jsx("input",{type:"hidden",name:"_wpnonce",value:o.settings.wp.alter}),s.jsx("input",{type:"hidden",name:"page_number",value:"1"}),s.jsx("input",{type:"hidden",name:"caller",value:"dataexplorer"}),s.jsx(m,{variant:"contained",type:"submit",children:"ALTER"})]})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:"Loads table into the Data Designer."})]}),f[r].pdsDbs===!0&&((H=(Q=o==null?void 0:o.settings)==null?void 0:Q.wp)==null?void 0:H.connect)!==!1&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(m,{variant:"contained",onClick:()=>{if(w!==""&&w>0&&T!==""){const e=new FormData;e.append("wpnonce",o.settings.wp.refresh),e.append("schema_name",r),e.append("table_name",t),e.append("interval",w.toString()),e.append("unit",T),le(e)}else i("Please enter valid scheduled update values",{variant:"error"})},children:"Refresh"})}),s.jsxs(n,{sx:{display:"grid",gridGap:"5px"},children:[s.jsx(n,{children:"Next scheduled update"}),s.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"start",alignItems:"center",gap:"5px"},children:[s.jsx(L,{type:"number",slotProps:{htmlInput:{min:0}},value:w,autoComplete:"off",onChange:e=>{const d=e.target.value.replaceAll("-","");F(d===""?"":Number(d))}}),s.jsxs(R,{MenuProps:{id:"pp-select-menu"},value:T,onChange:e=>{ae(e.target.value)},children:[s.jsx(u,{value:""}),s.jsx(u,{value:"hour",children:"hour"}),s.jsx(u,{value:"day",children:"day"})]})]}),s.jsx(E,{children:s.jsx(we,{children:"Enter and press REFRESH to apply"})})]})]}),o.create!==""&&s.jsxs(n,{className:"pp-action",children:[s.jsx(n,{children:s.jsx(fe,{text:o.create,onCopy:()=>{i("SQL successfully copied to clipboard",{variant:"info"})},children:s.jsx(ye,{title:"Copy SQL to clipboard",children:s.jsx(m,{variant:"contained",endIcon:s.jsx(je,{}),sx:{display:"flex",alignItems:"flex-start","& svg":{width:"50%"}},children:"SQL"})})})}),s.jsx(n,{sx:{display:"grid",gridGap:"5px"},children:s.jsx(n,{sx:{whiteSpace:"pre-wrap",fontSize:"70%"},children:o.create})})]})]}),s.jsx(k,{title:`Rename ${l===p.VIEW?"view":"table"}?`,message:"This can affect existing apps using this table!",open:ne,setOpen:I,onConfirm:()=>{de(r,t,v,e=>{if(j.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":l===p.VIEW?x(J({dbs:r})):x(_({dbs:r})),x(U()),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:console.error(e),i(e.message??c.contactSupport,{variant:"error"})}else console.error(e),i(c.contactSupport,{variant:"error"})},e=>{console.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:"Truncate table?",message:"This action cannot be undone!",open:re,setOpen:P,onConfirm:()=>{me(r,t,e=>{if(j.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:console.error(e),i(e.message??c.contactSupport,{variant:"error"})}else console.error(e),i(c.contactSupport,{variant:"error"})},e=>{console.error("error",e),i(e??c.contactSupport,{variant:"error"})})}}),s.jsx(k,{title:`Drop ${l===p.VIEW?"view":"table"}?`,message:"This action cannot be undone!",open:ie,setOpen:A,onConfirm:()=>{xe(r,t,l,e=>{if(j.debug(e),e!=null&&e.code&&(e==null?void 0:e.message)!==void 0)switch(e.code){case"ok":l===p.VIEW?x(J({dbs:r})):x(_({dbs:r})),x(U()),i(e.message,{variant:"success"});break;case"info":i(e.message,{variant:"info"});break;default:console.error(e),i(e.message??c.contactSupport,{variant:"error"})}else console.error(e),i(c.contactSupport,{variant:"error"})},e=>{console.error("error",e),i(e??c.contactSupport,{variant:"error"})})}})]})};export{rs as default};
