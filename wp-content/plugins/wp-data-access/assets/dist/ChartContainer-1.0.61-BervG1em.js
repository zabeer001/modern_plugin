const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SettingsChart-1.0.61-DElyrAtZ.js","./cm-1.0.61-D9ug3d5m.js","./redux-1.0.61-CrJ4jvTM.js","./vendor-1.0.61-CN03Eozo.js","./cmJson-1.0.61-BLURwXOE.js","./lib-1.0.61-DoXQcMHD.js","./loglevel-1.0.61-BZ7XahX3.js","./lodash-1.0.61-C8OpKhUs.js","./moment-1.0.61-C5S46NFB.js","./rehyperaw-1.0.61-AkovKNCK.js","./markdown-1.0.61-6nAzZWly.js","./index-1.0.61-B7tjLD84.js","./Typography-1.0.61-Cg0Css-P.js","./ButtonBase-1.0.61-BqsrQx8o.js","./useEnhancedEffect-1.0.61-CX4-xj9Z.js","./ThemeProvider-1.0.61-4HOD8y6D.js","./Modal-1.0.61-DVFPMIPt.js","./notistack-1.0.61-0awN6uG4.js","./iconBase-1.0.61-C8saXaJ2.js","./PremiumFeature-1.0.61-BxBWJ4MJ.js","./index-1.0.61-Cpc7oUnN.js","./AdminTheme-1.0.61-D8bUxwpM.js","./TextField-1.0.61-DyvT2G_W.js","./Select-1.0.61-DmroHcG5.js","./Menu-1.0.61-D2OtRuzX.js","./createSvgIcon-1.0.61-DDgmYdEo.js","./useChartSettings-1.0.61-BIp9UVZM.js","./useRemoveAppFromStore-1.0.61-E72jey9_.js","./Languages-1.0.61-BxgPwugF.js","./hooks-1.0.61-Bklk-gZu.js","./useLocaleUd-1.0.61-DEEqF_bH.js","./RestApi-1.0.61-DdTZ_pIc.js","./settings-1.0.61-BN5quc55.js","./Link-1.0.61-BHBICLVE.js","./TabPanel-1.0.61-BtYzUOMH.js","./InputAdornment-1.0.61-23wkGu1k.js","./cjs-1.0.61-D_0erLfe.js","./getThemeProps-1.0.61-OfsHdeDz.js","./ConfirmDialog-1.0.61-BrxkBu_y.js","./DialogContent-1.0.61-Ws3r0VFj.js","./Spinner-1.0.61-khi9zO7Q.js","./CardHeader-1.0.61-gDG-f_-J.js","./MenuItem-1.0.61-Bmr1xWyp.js","./settings-1.0.61-DuwCupdk.css","./AccordionSummary-1.0.61-B21Kp3oq.js","./Collapse-1.0.61-Cww0NnSm.js","./AccordionDetails-1.0.61-CrQNuW_u.js","./ChartColors-1.0.61-CQgivuZA.js","./RadioGroup-1.0.61-BZHJMWN9.js","./Radio-1.0.61-BXMcBwcB.js","./SwitchBase-1.0.61-C2xa6JFZ.js","./Slider-1.0.61-BGScnB2M.js","./visuallyHidden-1.0.61-Dan1xhjv.js","./Divider-1.0.61-C8DX248W.js","./FormControlLabel-1.0.61-Bu2IQ4da.js","./Switch-1.0.61-CRYcdQMV.js","./CssUnitTextField-1.0.61-BJIwFsSj.js","./ChartTypes-1.0.61-NPfELJPt.js","./Autocomplete-1.0.61-CP0PiliY.js","./Close-1.0.61-CiuKDfYz.js","./Chip-1.0.61-C6TjQKDp.js","./ThemeSettings-1.0.61-D8yINEx0.js","./AppTheme-1.0.61-CGnMRNDC.js","./index-1.0.61-CRnugLvI.js","./index-1.0.61-LP991tft.js","./Stack-1.0.61-CNGwl0k7.js","./DynamicModeEnum-1.0.61-BXuL5kgA.js","./ResizableDrawer-1.0.61-DK4GcbjM.js","./useScreenSize-1.0.61-B4FX7-PC.js"])))=>i.map(i=>d[i]);
import{j as e}from"./cm-1.0.61-D9ug3d5m.js";import{r as i}from"./redux-1.0.61-CrJ4jvTM.js";import{u as oe,C as ie}from"./Chart-1.0.61-Bgb2EiJM.js";import{_ as U}from"./cmJson-1.0.61-BLURwXOE.js";import{a0 as W,S as L,a1 as ae,b as ne,s as ce,l as p,a2 as le,a3 as me,a4 as pe,a as X,c as Z,Z as ue,a5 as he,a6 as de,a7 as fe,a8 as xe,C as ge,a9 as Se,t as be}from"./lib-1.0.61-DoXQcMHD.js";import{T as z}from"./Tooltip-1.0.61-De3BL3Jg.js";import{B as Ce,a as je,b as Te}from"./settings-1.0.61-BN5quc55.js";import{A as _e,T as ye,M as ke,D as Ae}from"./index-1.0.61-B7tjLD84.js";import{C as Ee}from"./ConfirmDialog-1.0.61-BrxkBu_y.js";import{A as Q,a as ve}from"./AdminTheme-1.0.61-D8bUxwpM.js";import{a as re}from"./hooks-1.0.61-Bklk-gZu.js";import{D as Be}from"./DynamicModeEnum-1.0.61-BXuL5kgA.js";import{a as we}from"./ActionsSettings-1.0.61-NFzvwy8a.js";import{e as O}from"./notistack-1.0.61-0awN6uG4.js";import{B as Ne,S as F}from"./Spinner-1.0.61-khi9zO7Q.js";import{f as Oe}from"./index-1.0.61-Cpig8940.js";import{T as Pe}from"./Typography-1.0.61-Cg0Css-P.js";import{I as V}from"./iconBase-1.0.61-C8saXaJ2.js";import{C as $,a as D}from"./CardHeader-1.0.61-gDG-f_-J.js";import{T as Re,a as ee}from"./TabPanel-1.0.61-BtYzUOMH.js";import{B as J}from"./cjs-1.0.61-D_0erLfe.js";import{R as Me}from"./RestApi-1.0.61-DdTZ_pIc.js";import{A as Le,u as ze}from"./AppTheme-1.0.61-CGnMRNDC.js";import{F as Fe}from"./FallbackSpinner-1.0.61-s3WTN65t.js";import{u as Ve}from"./useMetadata-1.0.61-CVl9oDgw.js";import{g as Je}from"./tab-1.0.61-B4c65fpQ.js";import{T as te}from"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./vendor-1.0.61-CN03Eozo.js";import"./useChartSettings-1.0.61-BIp9UVZM.js";import"./useRemoveAppFromStore-1.0.61-E72jey9_.js";import"./Languages-1.0.61-BxgPwugF.js";import"./useLocaleUd-1.0.61-DEEqF_bH.js";import"./useLocaleMrt-1.0.61-C3Pa4C9e.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./Link-1.0.61-BHBICLVE.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./TextField-1.0.61-DyvT2G_W.js";import"./Select-1.0.61-DmroHcG5.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./InputAdornment-1.0.61-23wkGu1k.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./MenuItem-1.0.61-Bmr1xWyp.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./TargetEnum-1.0.61-CIW1jlU5.js";import"./index-1.0.61-CRnugLvI.js";const Ue=i.lazy(()=>U(()=>import("./SettingsChart-1.0.61-DElyrAtZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url)),Ge=i.lazy(()=>U(()=>import("./ThemeSettings-1.0.61-D8yINEx0.js"),__vite__mapDeps([61,1,2,3,29,5,6,7,8,62,63,12,37,14,19,20,18,13,21,22,23,24,15,11,16,17,25,64,40,55,50,65,35,36,51,52,54,33,48,49,56,66,32,34,38,39,41,42,43,44,45,46]),import.meta.url)),He=i.lazy(()=>U(()=>import("./ResizableDrawer-1.0.61-DK4GcbjM.js"),__vite__mapDeps([67,1,2,3,68,5,6,7,8,29,12,15,14,13,16,17,24,11,18]),import.meta.url)),Ye=({appId:o})=>{var b,C;const l=re(),[P,y]=i.useState(W.getSelectors().selectChart(L.getState().charts,o)),[G,k]=i.useState(ae.getSelectors().selectThemeById(L.getState().themes,o)),t=oe(o),[A,u]=i.useState(!1),[R,h]=i.useState(!1),m=()=>{l(me()),u(!1)},d=()=>{A?h(!0):(a(),m())},c=r=>{p.debug(r),l(le({appId:o,property:r})),u(!0)},f=r=>{l(ce({anchor:r}))},a=()=>{l(pe({appId:o,chartState:P}))},g=()=>{we(o,r=>{if(p.debug(r),r!=null&&r.code&&(r==null?void 0:r.message)!==void 0)switch(r.code){case"ok":y(W.getSelectors().selectChart(L.getState().charts,o)),O(r.message,{variant:"success"});break;case"info":O(r.message,{variant:"info"});break;default:console.error(r),O(r.message??X.contactSupport,{variant:"error"})}},r=>{console.error("error",r),O(r??X.contactSupport,{variant:"error"})}),u(!1)},E=()=>{A?(g(),setTimeout(()=>{m()},1e3)):m()},v=((b=Q)==null?void 0:b.palette.mode)===ne.LIGHT?(C=Q)==null?void 0:C.palette.primary.main:"",[S,B]=i.useState(0),w=i.useMemo(()=>[{title:"Chart",icon:e.jsx(Ae,{})},{title:"Theme",icon:e.jsx(Oe,{})}],[]);return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(i.Suspense,{fallback:e.jsx(F,{}),children:e.jsxs(He,{closeDrawer:d,children:[e.jsxs(_e,{position:"static",elevation:4,sx:{borderRadius:0},children:[e.jsxs(ye,{className:"pp-setting-toolbar",sx:{borderRadius:0},children:[e.jsx(Pe,{variant:"h5",noWrap:!0,component:"div",className:"unselectable",sx:{flexGrow:1,paddingLeft:"6px"},children:"Chart Builder"}),e.jsx(z,{title:"Dock to left",position:"bottom",children:e.jsx(V,{onClick:()=>{f(Z.LEFT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(Ce,{})})}),e.jsx(z,{title:"Dock to right",position:"bottom",children:e.jsx(V,{onClick:()=>{f(Z.RIGHT)},size:"large",color:"inherit",sx:{fontSize:"1em"},children:e.jsx(je,{})})}),e.jsx(z,{title:"Close",position:"bottom",children:e.jsx(V,{onClick:d,size:"large",color:"inherit",sx:{fontSize:"1.4em"},children:e.jsx(ke,{})})})]}),e.jsx(Te,{menuItems:w,menuIndex:S,setMenu:B})]}),e.jsx($,{className:"pp-settings-container",children:e.jsx(D,{sx:{padding:0,margin:0},children:e.jsx(Re,{value:S,children:e.jsxs(Ne,{sx:{margin:0,padding:0,overflowX:"hidden",overflowY:"auto",height:"calc(calc(var(--ppViewHeight, 1vh) * 100) - 235px)","& > div.MuiTabPanel-root":{padding:0}},children:[e.jsx(ee,{value:0,children:e.jsx(i.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(Ue,{appId:o,updateSettings:c})})}),e.jsx(ee,{value:1,children:e.jsx(i.Suspense,{fallback:e.jsx(F,{}),children:e.jsx(Ge,{appId:o,source:Be.TABLE,setIsUpdated:u})})})]})})})}),e.jsx($,{className:"pp-setting-footer",sx:{borderRadius:0,backgroundColor:v},children:e.jsxs(D,{className:"pp-setting-footer-buttons",sx:{borderRadius:0},children:[e.jsx(J,{variant:"outlined",className:"footer_action_button_apply",onClick:g,children:"Apply"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:E,children:"OK"}),e.jsx(J,{variant:"outlined",className:"footer_action_button",onClick:d,children:"Cancel"})]})})]})}),e.jsx(Ee,{title:"Close Chart Builder?",message:"All uncommitted changes will be lost!",open:R,setOpen:h,onConfirm:()=>{a(),m()},onKeep:()=>{m()}})]})})},Ht=({appId:o,appDbId:l,shortcodeArgs:P})=>{p.debug(o,l);const y=re(),[G,k]=i.useState(!1),t=Ve(o),A=ze(),u=Le(A,be.table,Se.form),R=i.useMemo(()=>ve(),[]),h=c=>{switch(c.indexOf("(")>0?c.substring(0,c.indexOf("(")).toLowerCase():c){case"decimal":case"double":case"double precision":case"float":case"real":case"bit":case"tinyint":case"smallint":case"int":case"integer":case"mediumint":case"bigint":return"number";case"time":return"time";case"date":return"date";case"datetime":case"timestamp":return"datetime"}return"text"},m=()=>{var c,f;Me(ge.appUrlChartData,{app_id:l,search_custom:Je((f=(c=t==null?void 0:t.app)==null?void 0:c.container[0])==null?void 0:f.cnt_query),shortcode_params:P},a=>{var g,E,v,S,B,w,b,C,r,H,Y,q;if(p.debug(a),(a==null?void 0:a.data)!==void 0){if(Array.isArray(a.data)){const j=a.data,N=[];a.explain.map(s=>{s.Type?N.push(h(s.Type)):s.type?N.push(h(s.type)):s.TYPE&&N.push(h(s.TYPE))});const x=[],I=[];Object.keys(j[0]).map(s=>I.push(s)),x.push(I);for(let s=0;s<j.length;s++){const M=[];Object.keys(j[s]).map((K,se)=>N[se]==="text"?M.push(j[s][K]):M.push(Number(j[s][K]))),x.push(M)}p.debug(x);let n={};if(((E=(g=t==null?void 0:t.app)==null?void 0:g.container[0])==null?void 0:E.cnt_chart)!==void 0&&((S=(v=t==null?void 0:t.app)==null?void 0:v.container[0])==null?void 0:S.cnt_chart)!==null&&((w=(B=t==null?void 0:t.app)==null?void 0:B.container[0])==null?void 0:w.cnt_chart)!=="")try{n=JSON.parse(t.app.container[0].cnt_chart)}catch(s){console.error("Invalid JSON - chart settings"),console.error(s)}n===!1&&(n={}),p.debug(n);const T=he({},de,n);T.data=x,T.majorAxisColumn=x[0][0],T.minorAxisColumns=x[0].slice(1),Array.isArray(n==null?void 0:n.chartTypes)&&n.chartTypes.length>0&&(T.chartType=n.chartTypes[0]),y(fe({appId:o,chartState:T}));let _={};if(((C=(b=t==null?void 0:t.app)==null?void 0:b.app[0])==null?void 0:C.app_theme)!==void 0&&((H=(r=t==null?void 0:t.app)==null?void 0:r.app[0])==null?void 0:H.app_theme)!==null&&((q=(Y=t==null?void 0:t.app)==null?void 0:Y.app[0])==null?void 0:q.app_theme)!=="")try{_=JSON.parse(t.app.app[0].app_theme)}catch(s){console.error("Invalid JSON - theme settings"),console.error(s)}_===!1&&(_={}),p.debug(_),y(xe({appId:o,themeState:_})),k(!0)}}else console.error("Error loading chart data"),k(!0)},()=>{console.error("Error loading chart data"),k(!0)})};i.useEffect(()=>{m()},[]);const d=i.useMemo(()=>ue(t),[t]);return G?e.jsxs(e.Fragment,{children:[e.jsx(te,{theme:u,children:e.jsx(ie,{appId:o,isBuilderEnabled:d,isToolbarEnabled:!0,isExploring:(t==null?void 0:t.isExploring)===!0})}),d&&e.jsx(te,{theme:R,children:e.jsx(Ye,{appId:o})})]}):e.jsx(Fe,{})};export{Ht as default};
