const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./QueryParams-1.0.61-Bc13Xeg2.js","./cm-1.0.61-D9ug3d5m.js","./redux-1.0.61-CrJ4jvTM.js","./vendor-1.0.61-CN03Eozo.js","./TabPanel-1.0.61-BtYzUOMH.js","./InputAdornment-1.0.61-23wkGu1k.js","./cjs-1.0.61-D_0erLfe.js","./Typography-1.0.61-Cg0Css-P.js","./lib-1.0.61-DoXQcMHD.js","./loglevel-1.0.61-BZ7XahX3.js","./lodash-1.0.61-C8OpKhUs.js","./moment-1.0.61-C5S46NFB.js","./ButtonBase-1.0.61-BqsrQx8o.js","./useEnhancedEffect-1.0.61-CX4-xj9Z.js","./getThemeProps-1.0.61-OfsHdeDz.js","./Select-1.0.61-DmroHcG5.js","./Menu-1.0.61-D2OtRuzX.js","./ThemeProvider-1.0.61-4HOD8y6D.js","./index-1.0.61-B7tjLD84.js","./Modal-1.0.61-DVFPMIPt.js","./notistack-1.0.61-0awN6uG4.js","./iconBase-1.0.61-C8saXaJ2.js","./createSvgIcon-1.0.61-DDgmYdEo.js","./hooks-1.0.61-Bklk-gZu.js","./StartQueryBuilder-1.0.61-DpIXLFtV.js","./cmJson-1.0.61-BLURwXOE.js","./rehyperaw-1.0.61-AkovKNCK.js","./markdown-1.0.61-6nAzZWly.js","./useViewHeight-1.0.61-5KT6Wm-M.js","./PremiumFeature-1.0.61-BxBWJ4MJ.js","./index-1.0.61-Cpc7oUnN.js","./AdminTheme-1.0.61-D8bUxwpM.js","./TextField-1.0.61-DyvT2G_W.js","./CardHeader-1.0.61-gDG-f_-J.js","./Spinner-1.0.61-khi9zO7Q.js","./QuerySchedules-1.0.61-CcJ-yRTV.js","./MainQueryBuilder-1.0.61-CAqlR54P.js","./ActionsExplorer-1.0.61-Bj7vTxIj.js","./RestApi-1.0.61-DdTZ_pIc.js","./DatabaseTypeEnum-1.0.61-DeJfpW1u.js","./dayjs.min-1.0.61-21Xi_c_9.js","./ConfirmDialog-1.0.61-BrxkBu_y.js","./DialogContent-1.0.61-Ws3r0VFj.js","./QueryBuilder-1.0.61-CHDCBAvB.js","./index-1.0.61-Cpig8940.js","./SanitizeComponent-1.0.61-jz3CtJfW.js","./dompurify-1.0.61-DhD2mIk-.js","./FormControlLabel-1.0.61-Bu2IQ4da.js","./Checkbox-1.0.61-BlN5bjuH.js","./SwitchBase-1.0.61-C2xa6JFZ.js","./Divider-1.0.61-C8DX248W.js","./MenuItem-1.0.61-Bmr1xWyp.js","./TabList-1.0.61-CK8HCF5k.js","./Tabs-1.0.61-Bhozjonn.js","./Switch-1.0.61-CRYcdQMV.js","./main-1.0.61-CGp-2hVp.css","./TableRow-1.0.61-70IJJfOz.js","./TableHead-1.0.61-urAqheBu.js","./index-1.0.61-D2Hg54qq.js","./index-1.0.61-CxkvNEVW.js","./ctc-1.0.61-D7oYqo2X.js","./react-number-format.es-1.0.61-3K4hYgeH.js","./ToggleButtonGroup-1.0.61-31GAUuTm.js","./AdapterDayjs-1.0.61-BqcEbIuB.js","./useMobilePicker-1.0.61-Dvb2yEEp.js","./index-1.0.61-CRnugLvI.js","./visuallyHidden-1.0.61-Dan1xhjv.js","./ListItem-1.0.61-t1ycs9HY.js","./Chip-1.0.61-C6TjQKDp.js","./DateTimePicker-1.0.61-B22uat3C.js","./timeViewRenderers-1.0.61-Cu86BQXJ.js","./dateViewRenderers-1.0.61-7dkntk_V.js","./FileSaver.min-1.0.61-CuTNgRON.js","./AiAssistant-1.0.61-C0tUtLep.js","./AccordionSummary-1.0.61-B21Kp3oq.js","./Collapse-1.0.61-Cww0NnSm.js","./AccordionDetails-1.0.61-CrQNuW_u.js","./Autocomplete-1.0.61-CP0PiliY.js","./Close-1.0.61-CiuKDfYz.js"])))=>i.map(i=>d[i]);
import{_ as te}from"./cmJson-1.0.61-BLURwXOE.js";import{j as e}from"./cm-1.0.61-D9ug3d5m.js";import{r as a}from"./redux-1.0.61-CrJ4jvTM.js";import{_ as Pe,$ as Ie,e as P,A as De,T as we,S as Me,a9 as Re,B as Ee,aa as Oe,l as Le,ab as _e,ac as Qe,ad as Ne,M as Fe}from"./index-1.0.61-B7tjLD84.js";import{G as We,I as K}from"./iconBase-1.0.61-C8saXaJ2.js";import{P as Be}from"./index-1.0.61-D2Hg54qq.js";import{a as ne}from"./hooks-1.0.61-Bklk-gZu.js";import{b as be,i as ve,j as ie,u as ge,k as ze}from"./StartQueryBuilder-1.0.61-DpIXLFtV.js";import{A as D}from"./AdminTheme-1.0.61-D8bUxwpM.js";import{k as Ve}from"./index-1.0.61-Cpc7oUnN.js";import{A as ee,u as Ce,q as He,a as ye,b as Ue,c as Ge,d as Je}from"./QueryBuilder-1.0.61-CHDCBAvB.js";import{u as Xe}from"./MainQueryBuilder-1.0.61-CAqlR54P.js";import{l as O,o as ae,C as $e}from"./lib-1.0.61-DoXQcMHD.js";import{C as Ye}from"./index-1.0.61-CxkvNEVW.js";import{e as j}from"./notistack-1.0.61-0awN6uG4.js";import{N as Se}from"./react-number-format.es-1.0.61-3K4hYgeH.js";import{P as oe,D as le,a as ce,C as ke}from"./ConfirmDialog-1.0.61-BrxkBu_y.js";import{D as de,a as pe,b as xe}from"./DialogContent-1.0.61-Ws3r0VFj.js";import{B as d,S as Ze}from"./Spinner-1.0.61-khi9zO7Q.js";import{T as A,F as g,b as z,I as qe,a as se}from"./TextField-1.0.61-DyvT2G_W.js";import{T as Ke,a as je}from"./ToggleButtonGroup-1.0.61-31GAUuTm.js";import{B as L}from"./cjs-1.0.61-D_0erLfe.js";import{d as es}from"./dayjs.min-1.0.61-21Xi_c_9.js";import{P as ss}from"./PremiumFeature-1.0.61-BxBWJ4MJ.js";import{A as ts}from"./AdapterDayjs-1.0.61-BqcEbIuB.js";import{S as Te}from"./Select-1.0.61-DmroHcG5.js";import{M as u}from"./MenuItem-1.0.61-Bmr1xWyp.js";import{T as ns,a as rs,b as as,c as re}from"./TableRow-1.0.61-70IJJfOz.js";import{F as I}from"./FormControlLabel-1.0.61-Bu2IQ4da.js";import{S as is}from"./Switch-1.0.61-CRYcdQMV.js";import{C as E}from"./Checkbox-1.0.61-BlN5bjuH.js";import{L as os}from"./useMobilePicker-1.0.61-Dvb2yEEp.js";import{D as ls}from"./DateTimePicker-1.0.61-B22uat3C.js";import{a as cs}from"./RestApi-1.0.61-DdTZ_pIc.js";import{F as ds}from"./FileSaver.min-1.0.61-CuTNgRON.js";import{M as ps}from"./Menu-1.0.61-D2OtRuzX.js";function xs(n){return We({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"},child:[]}]})(n)}const us=({queries:n,queryKey:s,copyDialog:C,setCopyDialog:x,newName:l,setNewName:i})=>{var m,S,b,p;const f=ne(),{createQueryKey:T}=Ce(),[c,y]=a.useState(n[s].access);return e.jsxs(de,{open:C,onClose:()=>x(!1),PaperComponent:oe,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(le,{sx:{color:(S=(m=D)==null?void 0:m.palette)==null?void 0:S.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Copy query"}),e.jsx(pe,{children:e.jsx(ce,{component:"div",sx:{color:(p=(b=D)==null?void 0:b.palette)==null?void 0:p.primary.main},children:e.jsxs(d,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(A,{label:"Copy",disabled:!0,value:n[s].queryName}),e.jsx(A,{label:"To",value:l,onChange:h=>{i(h.target.value)}}),e.jsxs(g,{fullWidth:!0,children:[e.jsxs(Ke,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr","& svg":{marginRight:"5px",height:"1.2em",width:"1.2em"}},value:c,children:[e.jsxs(je,{value:ee.USER,onClick:()=>{y(ee.USER)},children:[e.jsx(Pe,{})," Only Me"]}),e.jsxs(je,{value:ee.GLOBAL,onClick:()=>{y(ee.GLOBAL)},children:[e.jsx(Ie,{})," Everyone"]})]}),e.jsx(z,{children:"Define who can access this query."})]})]})})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:h=>{x(!1);const o=T(c,l);He(n[s].access,n[s].queryName,c,l,v=>{O.debug(v),(v==null?void 0:v.code)==="ok"&&(f(be({queryKey:o,query:{access:c,queryName:l,query:n[s].query,schemaName:n[s].schemaName,isVisual:n[s].isVisual,params:n[s].params}})),f(ve({tabIndex:o})),j("Query succesfully saved",{variant:"success"}))},v=>{console.error(v),j(v,{variant:"error"})}),h.stopPropagation()},children:"Copy"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:h=>{x(!1),h.stopPropagation()},children:"Cancel"})]})})]})},ms=({queries:n,queryKey:s,renameDialog:C,setRenameDialog:x,newName:l,setNewName:i})=>{var y,m,S,b;const f=ne(),{createQueryKey:T}=Ce(),c=p=>{f(be({queryKey:p,query:{access:n[s].access,queryName:l,query:n[s].query,schemaName:n[s].schemaName,isVisual:n[s].isVisual,isInserting:n[s].isInserting,params:n[s].params}})),f(ie({queryKey:s})),f(ve({tabIndex:p}))};return e.jsxs(de,{open:C,onClose:()=>x(!1),PaperComponent:oe,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(le,{style:{color:(m=(y=D)==null?void 0:y.palette)==null?void 0:m.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Rename query"}),e.jsx(pe,{children:e.jsx(ce,{component:"div",sx:{color:(b=(S=D)==null?void 0:S.palette)==null?void 0:b.primary.main},children:e.jsxs(d,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(A,{label:"Old query name",disabled:!0,value:n[s].queryName}),e.jsx(A,{label:"New query name",value:l,onChange:p=>{i(p.target.value)}})]})})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:p=>{x(!1);const h=T(n[s].access,l);n[s].isInserting!==!0?ye(n[s].access,n[s].schemaName,l,ae(n[s].query),!1,n[s].queryName,!0,n[s].params,o=>{O.debug(o),(o==null?void 0:o.code)==="ok"&&(c(h),j("Query succesfully renamed",{variant:"success"}))},o=>{console.error(o),j(o,{variant:"error"})}):n[h]?j("Query name already exists",{variant:"error"}):c(h),p.stopPropagation()},children:"Rename"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:p=>{x(!1),p.stopPropagation()},children:"Cancel"})]})})]})},hs=({queries:n,queryKey:s,confirmDelete:C,setConfirmDelete:x})=>{const l=ne();return e.jsx(ke,{title:"Delete query",message:e.jsxs("div",{children:["Are you sure you want to delete query ",n[s].queryName,"?",e.jsx("br",{}),e.jsx("strong",{children:"This action cannot be undone!"})]}),open:C,setOpen:x,onConfirm:()=>{l(ie({queryKey:s})),Ue(n[s].access,n[s].queryName,i=>{O.debug(i),j("Query successfully deleted",{variant:"success"})},i=>{console.error(i),j(i,{variant:"error"})})}})},fs=({queryKey:n,queryBuilderState:s,scheduling:C,setScheduling:x,limit:l})=>{var W,X,B,$;Ge();const[i,f]=a.useState(es()),[T,c]=a.useState("nonrepeating"),[y,m]=a.useState(!0),[S,b]=a.useState(!0),[p,h]=a.useState(100),[o,v]=a.useState(s.queries[n].params),[_,V]=a.useState(!1),[H,Q]=a.useState(""),[N,U]=a.useState(!1),[F,G]=a.useState(!1),[w,J]=a.useState(!1);return a.useEffect(()=>{const r=localStorage.getItem("ppQueryBuilderNotify");if(r!==null){const k=JSON.parse(r);k.email&&(V(!0),Q(k.email),U(k.csv),G(k.json),J(k.xml))}},[]),a.useEffect(()=>{},[C]),e.jsxs(de,{open:C,onClose:()=>x(!1),PaperComponent:oe,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(le,{sx:{color:(X=(W=D)==null?void 0:W.palette)==null?void 0:X.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Schedule query"}),e.jsx(pe,{children:e.jsxs(ce,{component:"div",sx:{color:($=(B=D)==null?void 0:B.palette)==null?void 0:$.primary.main,marginTop:"5px",display:"grid",gap:"30px"},children:[e.jsx(os,{dateAdapter:ts,children:e.jsx(ls,{label:"Start date and time",value:i,onChange:r=>{f(r)},slotProps:{textField:{helperText:"First execution time."}},disabled:!0})}),e.jsxs(g,{fullWidth:!0,children:[e.jsx(qe,{variant:"outlined",children:"Recurrence"}),e.jsxs(Te,{MenuProps:{id:"pp-select-menu"},label:"Recurrence",value:T,onChange:r=>{c(r.target.value)},disabled:!0,children:[e.jsx(u,{value:"nonrepeating",children:"Only Once (non-repeating)"},"nonrepeating"),...Object.keys(s.cron.intervalSorted).map(r=>e.jsx(u,{value:s.cron.intervalSorted[r].key,children:s.cron.schedules[s.cron.intervalSorted[r].key].display},s.cron.intervalSorted[r].key))]}),e.jsx(z,{children:"How often the event should subsequently recur."})]}),o&&Object.keys(o).length>0&&e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Parameters"})}),e.jsx(ns,{sx:{width:"auto",margin:"10px 0 20px 5px","& *":{border:"none"},"& td":{padding:"10px",fontWeight:"bold"}},children:e.jsx(rs,{children:Object.keys(o).map(r=>e.jsxs(as,{children:[e.jsx(re,{sx:{paddingLeft:"16px !important",border:"none",color:"rgba(0, 0, 0, 0.38)"},children:r}),e.jsx(re,{sx:{border:"none",width:"20px",textAlign:"center",color:"rgba(0, 0, 0, 0.38)"},children:"="}),e.jsx(re,{sx:{border:"none"},children:e.jsx(P,{title:"",children:e.jsx(A,{type:"text",variant:"outlined",value:o[r],autoComplete:"off",onChange:k=>{const Y={...o};Y[r]=k.target.value,v(Y)},sx:{width:"60px","& input":{padding:0}},disabled:!0})})})]},r))})})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Settings"})}),e.jsxs(d,{sx:{padding:"20px 20px 25px 20px"},children:[e.jsxs(g,{fullWidth:!0,children:[e.jsx(I,{control:e.jsx(is,{checked:y,onChange:r=>{m(!y),r.stopPropagation()},disabled:!0}),label:"WordPress Table Protection"}),e.jsx(z,{sx:{marginTop:"5px"},children:"Protect WordPress tables to prevent accidental or harmful changes."})]}),e.jsxs(d,{sx:{marginTop:"10px",display:"flex",justifyContent:"start"},children:[e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"8px"},control:e.jsx(E,{checked:S,onClick:r=>{b(!S),r.preventDefault(),r.stopPropagation()},color:"primary",disabled:!0,sx:{marginRight:"10px"}}),label:"Max rows: "})}),e.jsx(Se,{customInput:A,value:p,disabled:!0,variant:"outlined",onValueChange:({value:r})=>{h(Number(r))},onInvalid:r=>{r.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})]})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Notifications"})}),e.jsxs(d,{sx:{padding:"20px 10px 20px 20px"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"9px"},control:e.jsx(E,{checked:_,onClick:r=>{V(!_),r.preventDefault(),r.stopPropagation()},color:"primary",disabled:!0}),label:""})}),e.jsx(A,{value:H,onChange:r=>{Q(r.target.value)},label:"Email",placeholder:"example@domain.com",fullWidth:!0,disabled:!0,sx:{"& input":{height:"8px",minHeight:"unset"}}})]}),!s.cron.mailEnabled&&e.jsx(g,{children:e.jsx(z,{children:"Mail server not available. Configure in Settings > Mail."})}),e.jsxs(d,{sx:{marginTop:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{children:"Add attachment"}),e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"9px"},control:e.jsx(E,{checked:N,onClick:r=>{U(!N),r.preventDefault(),r.stopPropagation()},color:"primary",disabled:!0}),label:"CSV"})}),e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"9px"},control:e.jsx(E,{checked:F,onClick:r=>{G(!F),r.preventDefault(),r.stopPropagation()},color:"primary",disabled:!0}),label:"JSON"})}),e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"9px"},control:e.jsx(E,{checked:w,onClick:r=>{J(!w),r.preventDefault(),r.stopPropagation()},color:"primary",disabled:!0}),label:"XML"})})]}),e.jsx(g,{children:e.jsx(z,{children:"Adds query results as attachments in the given formats."})})]})]}),e.jsx(d,{sx:{"& label":{marginTop:0}},children:e.jsx(ss,{})})]})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"10px 25px 30px 25px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",onClick:r=>{r.stopPropagation()},disabled:!0,children:"Schedule"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:r=>{x(!1),r.stopPropagation()},children:"Cancel"})]})})]})},gs=a.lazy(()=>te(()=>import("./QueryParams-1.0.61-Bc13Xeg2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]),import.meta.url)),js=a.lazy(()=>te(()=>import("./QuerySchedules-1.0.61-CcJ-yRTV.js"),__vite__mapDeps([35,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,29,30,31,32,36,25,26,27,23,24,28,37,38,39,34,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,33,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72]),import.meta.url)),bs=a.lazy(()=>te(()=>import("./QueryBuilder-1.0.61-CHDCBAvB.js").then(n=>n.g),__vite__mapDeps([43,25,1,2,3,8,9,10,11,26,27,18,7,12,13,17,19,20,21,41,6,31,42,23,24,28,36,37,38,39,34,4,5,14,15,16,22,44,45,46,32,47,48,49,50,51,52,53,54,55]),import.meta.url)),vs=a.lazy(()=>te(()=>import("./AiAssistant-1.0.61-C0tUtLep.js"),__vite__mapDeps([73,25,1,2,3,8,9,10,11,26,27,41,6,7,12,13,31,42,19,20,38,18,17,21,58,34,74,75,76,62,32,15,16,22,5,14,4,36,23,24,28,37,39,77,78,68]),import.meta.url)),Cs=({queries:n,queryKey:s,databases:C,setQueryResults:x})=>{var he;const l=ne(),i=Xe(),f=a.useRef(null),[T,c]=a.useState(null),y=!!T,[m,S]=a.useState(!0),[b,p]=a.useState(100),[h,o]=a.useState(!1),[v,_]=a.useState(!1),[V,H]=a.useState(!1),[Q,N]=a.useState(""),[U,F]=a.useState(!1),[G,w]=a.useState(!1),[J,W]=a.useState(!1),[X,B]=a.useState(!1),[$,r]=a.useState(!1),[k,Y]=a.useState(!1),[Ae,ue]=a.useState(!1),me=async()=>{if($)w(!0);else try{await cs($e.appUrlAiEnabled,{}).then(t=>{var Z,M,R,q,fe;O.debug(t),((Z=t==null?void 0:t.data)==null?void 0:Z.code)==="ok"&&((R=(M=t==null?void 0:t.data)==null?void 0:M.data)==null?void 0:R.enabled)===!0?(w(!0),r(!0)):(W(!0),Y(((fe=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:fe.encryption)===!0))}).catch(t=>{console.error(t)})}catch(t){console.error(t)}};return a.useEffect(()=>{i.openAI&&i.openAI.prompt!==void 0&&i.openAI.queryKey===s&&me()},[i.openAI]),e.jsxs(e.Fragment,{children:[e.jsx(De,{position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:e.jsxs(we,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx(P,{title:"Choose the database to run your query against",placement:"top",children:e.jsx(g,{children:e.jsxs(Te,{value:n[s].schemaName,MenuProps:{id:"pp-select-database"},size:"small",sx:{width:"250px",backgroundColor:"#fff"},onChange:t=>{l(ge({queryKey:s,query:{...n[s],schemaName:t.target.value}}))},children:[...C.databases.map(t=>e.jsx(u,{value:t.dbs,sx:{width:"250px"},children:t.dbs},t.dbs))]})})}),e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(P,{title:"Set a maximum number of rows to retrieve",children:e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(g,{children:e.jsx(I,{sx:{marginRight:"9px"},control:e.jsx(E,{checked:m,onClick:t=>{S(!m),t.preventDefault(),t.stopPropagation()},color:"secondary",sx:{"& svg":{fill:"#fff"}}}),label:"Max rows: "})}),e.jsx(Se,{customInput:A,value:b,disabled:!m,variant:"outlined",onValueChange:({value:t})=>{p(Number(t))},onInvalid:t=>{t.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})}),e.jsx(P,{title:"Execute query",children:e.jsx(K,{sx:{color:"inherit",marginLeft:"8px"},onClick:()=>{o(!0),Je(i.queries[s].schemaName,ae(i.queries[s].query),m?b.toString():"",i.protectWordPressTables,i.queries[s].params,t=>{O.debug(t),(t==null?void 0:t.code)==="ok"&&t.data?x(t.data):(console.error("Invalid response"),j("Invalid response",{variant:"error"})),o(!1)},t=>{console.error(t),j(t,{variant:"error"}),o(!1)})},children:h?e.jsx(d,{sx:{"& span.MuiCircularProgress-root":{width:"20px !important",height:"20px !important"},"& svg":{color:"#fff"}},children:e.jsx(Ze,{})}):e.jsx(Me,{})})}),e.jsx(a.Suspense,{children:e.jsx(gs,{queryKey:s,queryBuilderState:i})}),e.jsx(a.Suspense,{children:e.jsx(js,{queryKey:s,queryBuilderState:i})})]})]}),e.jsxs(d,{sx:{display:"flex",flexDirection:"row"},children:[e.jsx(P,{title:"Save query",children:e.jsx(K,{sx:{color:"inherit"},onClick:()=>{ye(i.queries[s].access,i.queries[s].schemaName,i.queries[s].queryName,ae(i.queries[s].query),!1,"",i.queries[s].isInserting,i.queries[s].params,t=>{O.debug(t),(t==null?void 0:t.code)==="ok"&&(l(ge({queryKey:s,query:{...i.queries[s],isInserting:void 0},isUpdated:!1})),j("Query succesfully saved",{variant:"success"}))},t=>{console.error(t),j(t,{variant:"error"})})},children:e.jsx(Ve,{})})}),e.jsx(P,{title:"AI Assistant",children:e.jsx(K,{onClick:async()=>{me()},sx:{color:"inherit"},children:e.jsx(Be,{})})}),e.jsx(P,{title:"More actions",children:e.jsx(K,{sx:{color:"inherit",padding:0},onClick:t=>{c(t.currentTarget),t.stopPropagation()},children:e.jsx(Re,{})})}),e.jsxs(ps,{anchorEl:T,open:y,onClose:()=>c(null),sx:{zIndex:9999999999},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(u,{onClick:()=>{c(null),_(!0)},disabled:n[s].isInserting===!0,children:[e.jsx(Ee,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy query"})]}),e.jsxs(u,{onClick:()=>{c(null),H(!0)},children:[e.jsx(Oe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Rename query"})]}),e.jsxs(u,{onClick:()=>{c(null),F(!0)},sx:{color:(he=D)==null?void 0:he.palette.error.main},disabled:n[s].isInserting===!0,children:[e.jsx(Le,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Delete query"})]}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{c(null),ue(!0)},disabled:n[s].isInserting===!0,children:[e.jsx(_e,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Schedule query"})]}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{f.current!==null&&f.current.click()},children:[e.jsx(Qe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Load from file"}),e.jsx("input",{ref:f,type:"file",onChange:t=>{if(t.target.files!==null){const Z=t.target.files[0];let M=new FileReader;M.onload=R=>{const q=R.target.result;l(ze({copyQuery:q}))},M.onerror=R=>alert(R.target.error.name),M.readAsText(Z)}},style:{height:0,width:0}})]}),e.jsxs(u,{onClick:()=>{ds(new Blob([n[s].query],{type:"text/sql;charset=utf-8"}),n[s].queryName+".sql")},children:[e.jsx(Ne,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Save to file"})]}),e.jsx(Ye,{text:n[s].query,onCopy:()=>{j("Query successfully copied to clipboard",{variant:"info"}),c(null)},children:e.jsxs(u,{children:[e.jsx(xs,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy to clipboard"})]})}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{l(ie({queryKey:s}))},children:[e.jsx(Fe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Close query"})]})]})]})]})}),e.jsx(us,{queries:n,queryKey:s,copyDialog:v,setCopyDialog:_,newName:Q,setNewName:N}),e.jsx(ms,{queries:n,queryKey:s,renameDialog:V,setRenameDialog:H,newName:Q,setNewName:N}),e.jsx(hs,{queries:n,queryKey:s,confirmDelete:U,setConfirmDelete:F}),e.jsx(ke,{title:"AI Assistant",message:e.jsx(d,{sx:{maxWidth:"430px"},children:"The AI Assistant is not yet enabled for your account. To start using it, you'll need to enter a valid API key. Would you like to configure the AI Assistant now?"}),open:J,setOpen:W,onConfirm:()=>{B(!0)}}),e.jsx(fs,{queryKey:s,queryBuilderState:i,scheduling:Ae,setScheduling:ue,limit:m?b.toString():""}),e.jsx(a.Suspense,{children:e.jsx(bs,{open:X,setOpen:B,encryption:k})}),e.jsx(a.Suspense,{children:e.jsx(vs,{queryKey:s,open:G,setOpen:w})})]})},rt=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"}));export{fs as D,rt as Q};
