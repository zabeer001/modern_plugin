import{j as t}from"./cm-1.0.61-D9ug3d5m.js";import{h as k,R as F,A as B,l as j,a5 as L,ao as D,G as R,ck as N}from"./lib-1.0.61-DoXQcMHD.js";import{b as v}from"./SharedContainer-1.0.61-D5Lln0NA.js";import{a as C}from"./hooks-1.0.61-Bklk-gZu.js";import{u as w}from"./useTableUpdater-1.0.61-D-pqUshE.js";import{u as H}from"./useMetadata-1.0.61-CVl9oDgw.js";import{H as P,c as z,d as K,e as U}from"./settings-1.0.61-BN5quc55.js";import{P as _}from"./PremiumFeature-1.0.61-BxBWJ4MJ.js";import{M as O,C as G}from"./MapsApiKey-1.0.61-BZRYtG-S.js";import{u as J}from"./useApp-1.0.61-C7D5dm7s.js";import{r as M}from"./redux-1.0.61-CrJ4jvTM.js";import{y as q}from"./index-1.0.61-B7tjLD84.js";import{A as W,a as Z}from"./AccordionSummary-1.0.61-B21Kp3oq.js";import{A as Q}from"./AccordionDetails-1.0.61-CrQNuW_u.js";import{F as T,b as A}from"./TextField-1.0.61-DyvT2G_W.js";import{F as V}from"./FormControlLabel-1.0.61-Bu2IQ4da.js";import{S as X}from"./Switch-1.0.61-CRYcdQMV.js";import{B as g}from"./Spinner-1.0.61-khi9zO7Q.js";import{T as Y,a as S}from"./ToggleButtonGroup-1.0.61-31GAUuTm.js";import{u as $,S as I,a as tt,b as et,c as ot}from"./SettingsMapMarkers-1.0.61-BiQurno6.js";import"./vendor-1.0.61-CN03Eozo.js";import"./loglevel-1.0.61-BZ7XahX3.js";import"./lodash-1.0.61-C8OpKhUs.js";import"./moment-1.0.61-C5S46NFB.js";import"./cmJson-1.0.61-BLURwXOE.js";import"./rehyperaw-1.0.61-AkovKNCK.js";import"./markdown-1.0.61-6nAzZWly.js";import"./AdminTheme-1.0.61-D8bUxwpM.js";import"./Typography-1.0.61-Cg0Css-P.js";import"./ActionsDml-1.0.61-DA32DqSB.js";import"./RestApi-1.0.61-DdTZ_pIc.js";import"./notistack-1.0.61-0awN6uG4.js";import"./useAppFunctions-1.0.61-EdKk0_Mu.js";import"./useStoreFormSettings-1.0.61-CgHnNhxx.js";import"./useRemoveAppFromStore-1.0.61-E72jey9_.js";import"./Languages-1.0.61-BxgPwugF.js";import"./AppTheme-1.0.61-CGnMRNDC.js";import"./index-1.0.61-CRnugLvI.js";import"./getThemeProps-1.0.61-OfsHdeDz.js";import"./useEnhancedEffect-1.0.61-CX4-xj9Z.js";import"./useChartSettings-1.0.61-BIp9UVZM.js";import"./useLocaleUd-1.0.61-DEEqF_bH.js";import"./useScreenSize-1.0.61-B4FX7-PC.js";import"./cjs-1.0.61-D_0erLfe.js";import"./ButtonBase-1.0.61-BqsrQx8o.js";import"./index-1.0.61-LP991tft.js";import"./dayjs.min-1.0.61-21Xi_c_9.js";import"./iconBase-1.0.61-C8saXaJ2.js";import"./dompurify-1.0.61-DhD2mIk-.js";import"./useFormDetails-1.0.61-677sicqv.js";import"./DynamicModeEnum-1.0.61-BXuL5kgA.js";import"./StoreTypeEnum-1.0.61-Tot-ESpR.js";import"./FallbackSpinner-1.0.61-s3WTN65t.js";import"./ThemeProvider-1.0.61-4HOD8y6D.js";import"./Modal-1.0.61-DVFPMIPt.js";import"./main-1.0.61.js";import"./Link-1.0.61-BHBICLVE.js";import"./TabPanel-1.0.61-BtYzUOMH.js";import"./InputAdornment-1.0.61-23wkGu1k.js";import"./Select-1.0.61-DmroHcG5.js";import"./Menu-1.0.61-D2OtRuzX.js";import"./createSvgIcon-1.0.61-DDgmYdEo.js";import"./ConfirmDialog-1.0.61-BrxkBu_y.js";import"./DialogContent-1.0.61-Ws3r0VFj.js";import"./CardHeader-1.0.61-gDG-f_-J.js";import"./MenuItem-1.0.61-Bmr1xWyp.js";import"./index-1.0.61-Cpc7oUnN.js";import"./Collapse-1.0.61-Cww0NnSm.js";import"./SwitchBase-1.0.61-C2xa6JFZ.js";import"./useMapUpdater-1.0.61-BifPauYu.js";import"./CssUnitTextField-1.0.61-BJIwFsSj.js";import"./RadioGroup-1.0.61-BZHJMWN9.js";import"./Radio-1.0.61-BXMcBwcB.js";import"./Slider-1.0.61-BGScnB2M.js";import"./visuallyHidden-1.0.61-Dan1xhjv.js";import"./react-number-format.es-1.0.61-3K4hYgeH.js";const rt=({appId:r,tableStore:d,mapSettings:h,updateTableSettings:s,setUpdateStatus:m})=>{var l;const i=H(r),b=M.useMemo(()=>{var p,a,u;let o=[];try{o=JSON.parse((u=(a=(p=i==null?void 0:i.app)==null?void 0:p.container)==null?void 0:a[0])==null?void 0:u.cnt_cls)}catch(f){console.error(f)}return o},[]);M.useEffect(()=>{c(k({appDbId:0,appId:r,appName:"",appTitle:"",appType:B.MAP,appCntId:0,appCntSeqNr:0,appDatabase:null,appTable:null,appColumns:b,appRelationTable:null,appRelationColumns:[],appRestApi:{authorization:F.AUTHORIZED,authorized_roles:[],authorized_users:[]},appAddToMenu:!1,appMenuTitle:"",appMetaData:void 0,mapApiKey:e.maps.apiKey,mapColumnLatitude:e.maps.columnLatitude,mapColumnLongitude:e.maps.columnLongitude}))},[]);const c=C(),n=J(),e=d.table;return M.useEffect(()=>{const o={...e.maps};o.apiKey=n.appMap.apiKey,o.columnLatitude=n.appMap.columnLatitude,o.columnLongitude=n.appMap.columnLongitude,s("maps",o)},[n.appMap]),t.jsxs(W,{disableGutters:!0,children:[t.jsxs(Z,{expandIcon:t.jsx(q,{}),className:"pp-context-help-summary",children:[t.jsx("span",{children:"Enable Map Integration"}),t.jsx(P,{path:"table-builder/menu/maps.html",size:22})]}),t.jsxs(Q,{children:[t.jsxs(T,{fullWidth:!0,sx:{marginBottom:0},children:[t.jsx(V,{control:t.jsx(X,{checked:e.maps.enabled,onChange:o=>{var a,u,f;const p={...e.maps};if(p.enabled=!e.maps.enabled,s("maps",p),h===void 0){let x={};if(((f=(u=(a=i==null?void 0:i.app)==null?void 0:a.container)==null?void 0:u[0])==null?void 0:f.cnt_map)!==void 0)try{x=JSON.parse(i.app.container[0].cnt_map)}catch(E){console.error("Invalid JSON - chart settings"),console.error(E)}x===!1&&(x={}),j.debug(x);const y=L({},D,x);c(R({appId:r,mapState:y}))}o.stopPropagation()}}),label:"Enable"}),t.jsx(A,{component:"div",children:"Enable this feature to add a map to the table header or footer."})]}),((l=e==null?void 0:e.maps)==null?void 0:l.enabled)===!0&&t.jsxs(g,{sx:{display:"grid",gap:"20px",marginTop:"30px"},children:[t.jsxs("fieldset",{className:"pp-fieldset",children:[t.jsx("legend",{children:"Map Configuration"}),t.jsxs(g,{sx:{display:"grid",gap:"30px",marginTop:"5px"},children:[t.jsx(O,{app:n}),t.jsx(g,{sx:{"& .MuiFormHelperText-root > div":{marginBottom:"5px"}},children:t.jsx(G,{app:n})}),t.jsxs(g,{sx:{marginTop:"-10px"},children:[t.jsxs(Y,{color:"primary",exclusive:!0,fullWidth:!0,value:"undocked",disabled:!0,onChange:(o,p)=>{const a={...e.maps};a.docked=p,s("maps",a),m(!0),o.stopPropagation()},children:[t.jsxs(S,{value:"top",disabled:d.state.masterDetailConditions!==void 0,children:[t.jsx(z,{})," Header"]}),t.jsxs(S,{value:"bottom",disabled:d.state.masterDetailConditions!==void 0,children:[t.jsx(K,{})," Footer"]}),t.jsxs(S,{value:"undocked",children:[t.jsx(U,{})," Undocked"]})]}),t.jsx(T,{children:t.jsx(A,{children:"Choose where the chart should be positioned: header, footer, or undocked. Charts for detail tables cannot be docked."})})]})]})]}),t.jsx(_,{title:"Some map configuration features require a premium license.",margin:"0"})]})]})]})},Ee=({appId:r})=>{var c,n;j.debug(r);const d=C(),h=w(r),s=v(r),m=$(r),i=(e,l,o)=>{const[p,...a]=l.split(".");return{...e,[p]:a.length?i(e[p],a.join("."),o):o}},b=(e,l)=>{j.debug(e,l);const o=i(s==null?void 0:s.table,e,l);j.debug(o),d(N({appId:r,tableSettings:o})),h(!0)};return t.jsxs(t.Fragment,{children:[t.jsx(rt,{appId:r,tableStore:s,mapSettings:m,updateTableSettings:b,setUpdateStatus:h}),((n=(c=s==null?void 0:s.table)==null?void 0:c.maps)==null?void 0:n.enabled)===!0&&m!==void 0&&t.jsxs(t.Fragment,{children:[t.jsx(I,{appId:r,mapSettings:m}),t.jsx(tt,{appId:r,mapSettings:m}),t.jsx(et,{appId:r,mapSettings:m,disableRadiusSearch:!0}),t.jsx(ot,{appId:r,mapSettings:m})]})]})};export{Ee as default};
